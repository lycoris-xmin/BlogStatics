$(function(){function t(o){if(o--,o<=0)return $("button[captcha]").clearBusy(),$("button[captcha]").text("验证码"),void sessionStorage.removeItem("captchaTimer");$("button[captcha]").is(":disabled")||$("button[captcha]").setBusy(),$("button[captcha]").text(`${o}s`),sessionStorage.setItem("captchaTimer",o),setTimeout(()=>{t(o)},1e3)}const o="authentication",i=$("button.unit");window.lycoris={totast:$.lycorisTotast()};const n={redirect:"/",loginSuccess:!1};$('input[name="email"]').on("change",function(){const t=$(this).val();t&&!$.regex.email(t)&&window.lycoris.totast.warn("邮箱格式错误")}),$("button[captcha]").on("click",async function(){window.lycoris.totast.warn("重构版本测试中，该功能还未开发")}),$("button[login]").on("click",function(){location.href=`/authentication/login${location.search}`}),$("button[home]").on("click",function(){location.href="/"}),$("button[register]").on("click",function(){location.href=`/authentication/register${location.search}`}),$("button[forget]").on("click",function(){window.lycoris.totast.warn("重构版本测试中，该功能还未开发")}),i.on("click",function(){$(this).data("type");window.lycoris.totast.warn(`${$(this).data("title")}登录还未开发`)});$.debounce(async function(){if(n.loginSuccess)return;const t=$("form").toJson();if(t.email)if($.regex.email(t.email))if(t.captcha)if(6==t.captcha.length)if(t.password)if(t.password.length<6)window.lycoris.totast.warn("密码长度不能小于6位");else if(t.confirmPassword)if(t.confirmPassword==t.password){$(this).setBusy();try{const i=$.createHttpRequest();i.url=`/${o}/register`,i.data={...t},delete i.data.confirmPassword;const e=await i.post();e&&0==e.resCode&&(n.loginSuccess=!0,window.lycoris.totast.success("注册成功"),setTimeout(()=>{location.href=`/${o}/login`},2e3))}finally{$(this).clearBusy()}}else window.lycoris.totast.warn("两次输入的密码不一致");else window.lycoris.totast.warn("密码确认不能为空");else window.lycoris.totast.warn("密码不能为空");else window.lycoris.totast.warn("邮箱验证码错误");else window.lycoris.totast.warn("邮箱验证码不能为空");else window.lycoris.totast.warn("邮箱格式错误");else window.lycoris.totast.warn("邮箱不能为空")},500);this.init=function(){if(window.lycoris.totast=$.lycorisTotast(),$('script[type="application/json"]').length){const t=$('script[type="application/json"]').text(),o=JSON.parse(t);o&&Object.keys(o).length&&o.redirect&&(n.redirect=o.redirect)}$(".line-loading-preloader").removeClass("show-loading").remove(),window.onload=function(){const o=sessionStorage.getItem("forget-captchaTimer");null!=o&&(o>0?t(o):sessionStorage.removeItem("forget-captchaTimer"))}},this.init()});