$(function(){function t(o){if(o--,o<=0)return $("button[captcha]").clearBusy(),$("button[captcha]").text("验证码"),void sessionStorage.removeItem("captchaTimer");$("button[captcha]").is(":disabled")||$("button[captcha]").setBusy(),$("button[captcha]").text(`${o}s`),sessionStorage.setItem("captchaTimer",o),setTimeout(()=>{t(o)},1e3)}function o(t){if(t.endsWith("@163.com")||t.endsWith("@qq.com")){var o=t.split("@"),e=o[1].split(".");return`https://mail.${e[0]}.com`}return t.endsWith("@outlook.com")?"https://www.outlook.com":""}function e(){var t=document.createElement("form");t.method="POST",t.action="https://mail.qq.com",t.style.display="none",t.target="_blank",document.body.appendChild(t),t.submit(),t.remove()}const i="authentication",n=$("button.unit");window.lycoris={totast:$.lycorisTotast()};const s={redirect:"/",loginSuccess:!1};$('input[name="email"]').on("change",function(){const t=$(this).val();t&&!$.regex.email(t)&&window.lycoris.totast.warn("邮箱格式错误")}),$("button[captcha]").on("click",async function(){const n=$('input[name="email"]').val();if(n)if($.regex.email(n)){$(this).setBusy();try{const s=$.createHttpRequest();s.url=`/${i}/register/captcha`,s.data={email:n};const c=await s.post();c&&0==c.resCode&&(t(60),window.lycoris.totast.success("验证码已发送"),setTimeout(()=>{const t=o(n);if(t){const o=confirm("是否需要跳转至邮箱网站");o&&(t.includes("https://mail.qq.com")?e():window.open(t))}},2e3))}catch(t){$(this).clearBusy()}}else window.lycoris.totast.warn("邮箱格式错误");else window.lycoris.totast.warn("邮箱不能为空")}),$("button[home]").on("click",function(){location.href="/"}),$("button[login]").on("click",function(){location.href=`/authentication/login${location.search}`}),$("button[forget]").on("click",function(){location.href=`/authentication/forget${location.search}`}),$("button[register]").on("click",function(){c.call(this)}),n.on("click",function(){$(this).data("type");window.lycoris.totast.warn(`${$(this).data("title")}登录还未开发`)});const c=$.debounce(async function(){if(s.loginSuccess)return;const t=$("form").toJson();if(t.email)if($.regex.email(t.email))if(t.captcha)if(6==t.captcha.length)if(t.password)if(t.password.length<6)window.lycoris.totast.warn("密码长度不能小于6位");else if(t.confirmPassword)if(t.confirmPassword==t.password){$(this).setBusy();try{const o=$.createHttpRequest();o.url=`/${i}/register`,o.data={...t},delete o.data.confirmPassword;const e=await o.post();e&&0==e.resCode&&(s.loginSuccess=!0,window.lycoris.totast.success("注册成功"),setTimeout(()=>{location.href=`/${i}/login`},2e3))}finally{$(this).clearBusy()}}else window.lycoris.totast.warn("两次输入的密码不一致");else window.lycoris.totast.warn("密码确认不能为空");else window.lycoris.totast.warn("密码不能为空");else window.lycoris.totast.warn("邮箱验证码错误");else window.lycoris.totast.warn("邮箱验证码不能为空");else window.lycoris.totast.warn("邮箱格式错误");else window.lycoris.totast.warn("邮箱不能为空")},500);this.init=function(){if(window.lycoris.totast=$.lycorisTotast(),$('script[type="application/json"]').length){const t=$('script[type="application/json"]').text(),o=JSON.parse(t);o&&Object.keys(o).length&&o.redirect&&(s.redirect=o.redirect)}$(".line-loading-preloader").removeClass("show-loading").remove(),window.onload=function(){const o=sessionStorage.getItem("captchaTimer");null!=o&&(o>0?t(o):sessionStorage.removeItem("captchaTimer"))}},this.init()});