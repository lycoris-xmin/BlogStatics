$(async function(){function e(e){return e.map(e=>({x:e.x,y:e.y,z:e.z}))}function t(e,t){const o=e.length;for(let n=0;n<o;n++){const o=e[n],a=t[n];a.x=o.x,a.y=o.y,a.z=o.z}}function o(e){const t=e.vertices;e.middle.x=(t[0].x+t[1].x+t[2].x)/3,e.middle.y=(t[0].y+t[1].y+t[2].y)/3,e.middle.z=(t[0].z+t[1].z+t[2].z)/3}function n(e){const t=e.vertices;e.middle.x=(t[0].x+t[1].x+t[2].x+t[3].x)/4,e.middle.y=(t[0].y+t[1].y+t[2].y+t[3].y)/4,e.middle.z=(t[0].z+t[1].z+t[2].z+t[3].z)/4}function a(e){3===e.vertices.length?o(e):n(e)}function r(e){a(e);const t=e.middle.x,o=e.middle.y,n=e.middle.z-ze;e.depth=Math.hypot(t,o,n)}function s(e,t){const o=e.vertices[0],n=e.vertices[1],a=e.vertices[2],r=o.x-n.x,s=o.y-n.y,i=o.z-n.z,c=o.x-a.x,l=o.y-a.y,h=o.z-a.z,y=s*h-i*l,x=i*c-r*h,d=r*l-s*c,m=Math.hypot(y,x,d),u=e[t];u.x=y/m,u.y=x/m,u.z=d/m}function i(e,t,o,n,a,r,s,i,c,l,h){const y=Math.sin(r),x=Math.cos(r),d=Math.sin(s),m=Math.cos(s),u=Math.sin(i),f=Math.cos(i);e.forEach((e,r)=>{const s=t[r],i=e.x,p=e.z*y+e.y*x,z=e.z*x-e.y*y,g=i*m-z*d,w=p,v=i*d+z*m,D=g*f-w*u,b=g*u+w*f,M=v;s.x=D*c+o,s.y=b*l+n,s.z=M*h+a})}function c({scale:e=1}){return{vertices:[{x:-e,y:-e,z:e},{x:e,y:-e,z:e},{x:e,y:e,z:e},{x:-e,y:e,z:e},{x:-e,y:-e,z:-e},{x:e,y:-e,z:-e},{x:e,y:e,z:-e},{x:-e,y:e,z:-e}],polys:[{vIndexes:[0,1,2,3]},{vIndexes:[7,6,5,4]},{vIndexes:[3,2,6,7]},{vIndexes:[4,5,1,0]},{vIndexes:[5,6,2,1]},{vIndexes:[0,3,7,4]}]}}function l({recursionLevel:e,splitFn:t,color:o,scale:n=1}){const a=e=>1/3**e;let r=[{x:0,y:0,z:0}];for(let o=1;o<=e;o++){const e=2*a(o),n=[];r.forEach(o=>{n.push(...t(o,e))}),r=n}const s={vertices:[],polys:[]},i=c({scale:1});i.vertices.forEach(st(a(e)));a(e);return r.forEach((e,t)=>{Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));s.vertices.push(...i.vertices.map(t=>({x:(t.x+e.x)*n,y:(t.y+e.y)*n,z:(t.z+e.z)*n}))),s.polys.push(...i.polys.map(e=>({vIndexes:e.vIndexes.map(rt(8*t))})))}),s}function h(e,t){return[{x:e.x+t,y:e.y-t,z:e.z+t},{x:e.x+t,y:e.y-t,z:e.z+0},{x:e.x+t,y:e.y-t,z:e.z-t},{x:e.x+0,y:e.y-t,z:e.z+t},{x:e.x+0,y:e.y-t,z:e.z-t},{x:e.x-t,y:e.y-t,z:e.z+t},{x:e.x-t,y:e.y-t,z:e.z+0},{x:e.x-t,y:e.y-t,z:e.z-t},{x:e.x+t,y:e.y+t,z:e.z+t},{x:e.x+t,y:e.y+t,z:e.z+0},{x:e.x+t,y:e.y+t,z:e.z-t},{x:e.x+0,y:e.y+t,z:e.z+t},{x:e.x+0,y:e.y+t,z:e.z-t},{x:e.x-t,y:e.y+t,z:e.z+t},{x:e.x-t,y:e.y+t,z:e.z+0},{x:e.x-t,y:e.y+t,z:e.z-t},{x:e.x+t,y:e.y+0,z:e.z+t},{x:e.x+t,y:e.y+0,z:e.z-t},{x:e.x-t,y:e.y+0,z:e.z+t},{x:e.x-t,y:e.y+0,z:e.z-t}]}function y(e,t=1e-4){const{vertices:o,polys:n}=e,a=(e,o)=>Math.abs(e.x-o.x)<t&&Math.abs(e.y-o.y)<t&&Math.abs(e.z-o.z)<t,r=(e,t)=>{const o=e.vIndexes,n=t.vIndexes;return!(o[0]!==n[0]&&o[0]!==n[1]&&o[0]!==n[2]&&o[0]!==n[3]||o[1]!==n[0]&&o[1]!==n[1]&&o[1]!==n[2]&&o[1]!==n[3]||o[2]!==n[0]&&o[2]!==n[1]&&o[2]!==n[2]&&o[2]!==n[3]||o[3]!==n[0]&&o[3]!==n[1]&&o[3]!==n[2]&&o[3]!==n[3])};o.forEach((e,t)=>{e.originalIndexes=[t]});for(let e=o.length-1;e>=0;e--)for(let t=e-1;t>=0;t--){const n=o[e],r=o[t];if(a(n,r)){o.splice(e,1),r.originalIndexes.push(...n.originalIndexes);break}}o.forEach((e,t)=>{n.forEach(o=>{o.vIndexes.forEach((o,n,a)=>{const r=e.originalIndexes;r.includes(o)&&(a[n]=t)})})}),n.forEach(e=>{const t=e.vIndexes;e.sum=t[0]+t[1]+t[2]+t[3]}),n.sort((e,t)=>t.sum-e.sum);for(let e=n.length-1;e>=0;e--)for(let t=e-1;t>=0;t--){const o=n[e],a=n[t];if(o.sum!==a.sum)break;if(r(o,a)){n.splice(e,1),n.splice(t,1),e--;break}}return e}function x(){for(;dt.length;)zt(dt.pop())}function d(e,t,o,n){const a=Et.pop()||{};return a.x=e+.5*o,a.y=t+.5*n,a.xD=o,a.yD=n,a.life=Ge(200,300),a.maxLife=a.life,Mt.push(a),a}function m(e,t,o,n){const a=qe/o;for(let r=0;r<o;r++){const o=r*a+a*Math.random(),s=(1-Math.random()**3)*n;d(e,t,Math.sin(o)*s,Math.cos(o)*s)}}function u(o){St?t(o.vertices,St):St=e(o.vertices),St.forEach(e=>{Math.random()<.4&&(it(e),d(e.x,e.y,Ge(-12,12),Ge(-12,12)))})}function f(e){Et.push(e)}function p(e){kt.style.display=e?"block":"none"}function z(){Ze()?(It.style.display="none",Pt.style.opacity=1):(It.innerText=`分数: ${Le.game.score}`,It.style.display="block",Pt.style.opacity=.65),Pt.innerText=`切中次数: ${Le.game.cubeCount}`}function g(e){Ct.style.opacity=0===e?0:1,Xt.style.transform="scaleX($selector {percentRemaining.toFixed(3)})"}function w(e){e.classList.add("active")}function v(e){e.classList.remove("active")}function D(){switch(v(Yt),v(Tt),v(Zt),Le.menus.active){case Pe:w(Yt);break;case Ce:w(Tt);break;case Xe:Wt.textContent=Ve(Le.game.score),$e()?jt.textContent="创造了一个新纪录!":Ae().then(e=>{jt.textContent=`最高分数: ${Ve(e)}`}),w(Zt)}p(!Te()),Lt.classList.toggle("has-active",Te()),Lt.classList.toggle("interactive-mode",Te()&&J)}function b(e){Le.menus.active=e,D()}function M(e){Le.game.score=e,z()}function E(e){Ye()&&(Le.game.score+=e,Le.game.score<0&&(Le.game.score=0),z())}function S(e){Le.game.cubeCount=e,z()}function k(e){Ye()&&(Le.game.cubeCount+=e,z())}function I(e){Le.game.mode=e}function P(){x(),Le.game.time=0,ot(),M(0),S(0),_t=V()}function C(){Ye()&&b(Ce)}function X(){We()&&b(null)}function L(){j(),$e()&&Ue(Le.game.score),b(Xe)}function Y(e,t,o,n,a){if(lt("frame"),lt("tick"),Le.game.time+=o,Rt>0)Rt-=o,Rt<0&&(Rt=0),Vt=J?.075:.3;else{const e=Te()&&J;Vt=e?.025:1}g(Rt/$t),A+=(Vt-A)/22*a,A=He(A,0,1);const c=e/2,l=t/2,h=1-ae*n,y=1-ce*n,x=1/(.75*n+.25);Nt.x=0,Nt.y=0,Ut.x=0,Ut.y=0;const d=xe[xe.length-1];J&&d&&!d.touchBreak&&(Nt.x=Q.x-d.x,Nt.y=Q.y-d.y,Ut.x=Nt.x*x,Ut.y=Nt.y*x);const p=Math.hypot(Nt.x,Nt.y),z=p*x;for(xe.forEach(e=>e.life-=o),J&&xe.push({x:Q.x,y:Q.y,life:ye});xe[0]&&xe[0].life<=0;)xe.shift();if(lt("entities"),_t-=o,_t<=0){Bt>0?(Bt--,_t=Ft):_t=V();const e=ft(),t=Math.min(.8*c,At);e.x=Math.random()*t*2-t,e.y=l+2*me,e.z=Math.random()*de*2-de,e.xD=Math.random()*(-2*e.x/120),e.yD=-20,dt.push(e)}const w=-c+de,v=c-de,D=-l-120,b=.4;e:for(let e=dt.length-1;e>=0;e--){const t=dt[e];if(t.x+=t.xD*n,t.y+=t.yD*n,t.y<D&&(t.y=D,t.yD=0),t.x<w?(t.x=w,t.xD*=-b):t.x>v&&(t.x=v,t.xD*=-b),t.z<oe&&(t.z=oe,t.zD*=-b),t.yD+=re*n,t.rotateX+=t.rotateXD*n,t.rotateY+=t.rotateYD*n,t.rotateZ+=t.rotateZD*n,t.transform(),t.project(),t.y>l+2*me){dt.splice(e,1),zt(t),Ye()&&(Ze()?E(-25):L());continue}const o=Math.ceil(p/de*2);for(let n=1;n<=o;n++){const a=1-n/o,r=Q.x-Nt.x*a,s=Q.y-Nt.y*a,i=Math.hypot(r-t.projected.x,s-t.projected.y);if(i<=me){if(!t.hit){t.hit=!0,t.xD+=Ut.x*te,t.yD+=Ut.y*te,t.rotateXD+=.001*Ut.y,t.rotateYD+=.001*Ut.x;const o=7+.125*z;z>ee?(t.health--,E(10),t.health<=0?(k(1),Dt(t,x),m(r,s,8,o),t.wireframe&&(Rt=$t,_t=0,Bt=2),dt.splice(e,1),zt(t)):(m(r,s,8,o),u(t),pt(t,0))):(E(5),m(r,s,3,o))}continue e}}t.hit=!1}const M=oe+fe,S=-e,I=e;for(let e=gt.length-1;e>=0;e--){const t=gt[e];t.x+=t.xD*n,t.y+=t.yD*n,t.z+=t.zD*n,t.xD*=h,t.yD*=h,t.zD*=h,t.y<D&&(t.y=D,t.yD=0),t.z<M&&(t.z=M,t.zD*=-b),t.yD+=re*n,t.rotateX+=t.rotateXD*n,t.rotateY+=t.rotateYD*n,t.rotateZ+=t.rotateZD*n,t.transform(),t.project(),(t.projected.y>l+me||t.projected.x<S||t.projected.x>I||t.z>ve)&&(gt.splice(e,1),bt(t))}for(let e=Mt.length-1;e>=0;e--){const t=Mt[e];t.life-=o,t.life<=0?(Mt.splice(e,1),f(t)):(t.x+=t.xD*n,t.y+=t.yD*n,t.xD*=y,t.yD*=y,t.yD+=re*n)}ht("entities"),lt("3D"),be.length=0,Me.length=0,Ee.length=0,Se.length=0,dt.forEach(e=>{be.push(...e.vertices),Me.push(...e.polys),Ee.push(...e.shadowVertices),Se.push(...e.shadowPolys)}),gt.forEach(e=>{be.push(...e.vertices),Me.push(...e.polys),Ee.push(...e.shadowVertices),Se.push(...e.shadowPolys)}),Me.forEach(e=>s(e,"normalWorld")),Me.forEach(r),Me.sort((e,t)=>t.depth-e.depth),be.forEach(it),Me.forEach(e=>s(e,"normalCamera")),ht("3D"),lt("shadows"),i(Ee,Ee,0,0,0,qe/8,0,0,1,1,1),Se.forEach(e=>s(e,"normalWorld"));const P=Math.hypot(1,1),C=Ee.length;for(let e=0;e<C;e++){const t=be[e].z-oe;Ee[e].z-=P*t}i(Ee,Ee,0,0,0,-qe/8,0,0,1,1,1),Ee.forEach(it),ht("shadows"),ht("tick")}function T(e,t,o,n){lt("draw");e.lineJoin="bevel",lt("drawShadows"),e.fillStyle=ne,e.strokeStyle=ne,Se.forEach(t=>{if(t.wireframe){e.lineWidth=2,e.beginPath();const{vertices:o}=t,n=o.length,a=o[0];e.moveTo(a.x,a.y);for(let t=1;t<n;t++){const n=o[t];e.lineTo(n.x,n.y)}e.closePath(),e.stroke()}else{e.beginPath();const{vertices:o}=t,n=o.length,a=o[0];e.moveTo(a.x,a.y);for(let t=1;t<n;t++){const n=o[t];e.lineTo(n.x,n.y)}e.closePath(),e.fill()}}),ht("drawShadows"),lt("drawPolys"),Me.forEach(t=>{if(!t.wireframe&&t.normalCamera.z<0)return;0!==t.strokeWidth&&(e.lineWidth=t.normalCamera.z<0?.5*t.strokeWidth:t.strokeWidth,e.strokeStyle=t.normalCamera.z<0?t.strokeColorDark:t.strokeColor);const{vertices:o}=t,n=o[o.length-1],a=t.middle.z>we;if(!t.wireframe){const o=.5*t.normalWorld.y+-.5*t.normalWorld.z,n=o>0?.1:(o**32-o)/2*.9+.1;e.fillStyle=Qe(t.color,n)}a&&(e.globalAlpha=Math.max(0,1-(t.middle.z-we)/De)),e.beginPath(),e.moveTo(n.x,n.y);for(let t of o)e.lineTo(t.x,t.y);t.wireframe||e.fill(),0!==t.strokeWidth&&e.stroke(),a&&(e.globalAlpha=1)}),ht("drawPolys"),lt("draw2D"),e.strokeStyle=se,e.lineWidth=ie,e.beginPath(),Mt.forEach(t=>{e.moveTo(t.x,t.y);const o=(t.life/t.maxLife)**.5*1.5;e.lineTo(t.x-t.xD*o,t.y-t.yD*o)}),e.stroke(),e.strokeStyle=le;const a=xe.length;for(let t=1;t<a;t++){const o=xe[t],n=xe[t-1];if(o.touchBreak||n.touchBreak)continue;const a=o.life/ye;e.lineWidth=a*he,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.stroke()}ht("draw2D"),ht("draw"),ht("frame"),yt()}function Z(){function e(){const e=Re("div.container").clientWidth,t=Re("div.container").clientHeight;a=t/1e3,r=e/a,s=t/a,pe.width=e*n,pe.height=t*n,pe.style.width=e+"px",pe.style.height=t+"px"}function t(e){let t=e-i;if(i=e,c(),We())return;t<0?t=17:t>68&&(t=68);const l=r/2,h=s/2;Q.x=K.x/a-l,Q.y=K.y/a-h;const y=t/16.6667,x=A*t,d=A*y;Y(r,s,x,d,y),o.clearRect(0,0,pe.width,pe.height);const m=n*a;o.scale(m,m),o.translate(l,h),T(o,r,s,a),o.setTransform(1,0,0,1,0,0)}const o=pe.getContext("2d"),n=window.devicePixelRatio||1;let a,r,s;e(),window.addEventListener("resize",e);let i=0;const c=()=>requestAnimationFrame(t);c()}function W(e,t){J||(J=!0,K.x=e,K.y=t,Te()&&D())}function j(){J&&(J=!1,xe.push({touchBreak:!0,life:ye}),Te()&&D())}function _(e,t){J&&(K.x=e,K.y=t)}let A=1;const N={r:103,g:215,b:240},U={r:166,g:224,b:44},R={r:250,g:36,b:115},B={r:254,g:149,b:34},F=[N,U,R,B],V=()=>{const e=1400,t=550,o=e-3.1*Le.game.cubeCount;return Math.max(o,t)},q=2e3,H=10,O=25,G=25;let J=!1,K={x:0,y:0},Q={x:0,y:0};const ee=60,te=.1,oe=-400,ne="#262e36",ae=.022,re=.3,se="rgba(170,221,255,.9)",ie=2.2,ce=.1,le="rgba(170,221,255,.62)",he=7,ye=120,xe=[],de=40,me=50,ue=e=>"rgb(170,221,255)",fe=de/3,pe=document.querySelector("#c"),ze=900,ge=1,we=.45*ze,ve=.65*ze,De=ve-we,be=[],Me=[],Ee=[],Se=[],ke=Symbol("GAME_MODE_RANKED"),Ie=Symbol("GAME_MODE_CASUAL"),Pe=Symbol("MENU_MAIN"),Ce=Symbol("MENU_PAUSE"),Xe=Symbol("MENU_SCORE"),Le={game:{mode:ke,time:0,score:0,cubeCount:0},menus:{active:Pe}},Ye=()=>!Le.menus.active,Te=()=>!!Le.menus.active,Ze=()=>Le.game.mode===Ie,We=()=>Le.menus.active===Ce,je="__menja__highScore",_e=$.indexDb("lycoris-blog","blog"),Ae=async()=>{const e=await _e.getData(je);let t=0;return e?t=parseInt(e.source,10):await _e.create({id:je,source:0}),t=parseInt(t,10),isNaN(t)?0:t};let Ne=await Ae();const Ue=async e=>{Ne=await Ae(),await _e.update({id:je,source:e})},$e=()=>Le.game.score>Ne,Re=e=>document.querySelector(e),Be=(e,t)=>e.addEventListener("click",t),Fe=(e,t)=>{e.addEventListener("touchstart",t),e.addEventListener("mousedown",t)},Ve=e=>e.toLocaleString(),qe=(Math.PI,2*Math.PI),He=(Math.PI,(e,t,o)=>Math.min(Math.max(e,t),o)),Oe=(e,t,o)=>(t-e)*o+e,Ge=(e,t)=>Math.random()*(t-e)+e,Je=e=>e[Math.random()*e.length|0],Ke=e=>"#"+(0|e.r).toString(16).padStart(2,"0")+(0|e.g).toString(16).padStart(2,"0")+(0|e.b).toString(16).padStart(2,"0"),Qe=(e,t)=>{let o,n;return t<.5?(o=0,n=1-2*t):(o=255,n=2*t-1),"#"+(0|Oe(e.r,o,n)).toString(16).padStart(2,"0")+(0|Oe(e.g,o,n)).toString(16).padStart(2,"0")+(0|Oe(e.b,o,n)).toString(16).padStart(2,"0")},et=[],tt=(e,t=1)=>{let o=0,n=0;const a={rechargeTime:e,units:t},r=()=>{const e=Le.game.time;e<n?o=0:(o-=e-n,o<0&&(o=0)),n=e},s=()=>(r(),o<=e*(t-1)),i={canUse:s,useIfAble(){const t=s();return t&&(o+=e),t},mutate(n){n.rechargeTime&&(o-=e-n.rechargeTime,o<0&&(o=0),e=n.rechargeTime),n.units&&(t=n.units)},reset(){o=0,n=0,this.mutate(a)}};return et.push(i),i},ot=()=>et.forEach(e=>e.reset()),nt=({chance:e,cooldownPerSpawn:t,maxSpawns:o})=>{const n=tt(t,o);return{shouldSpawn:()=>Math.random()<=e&&n.useIfAble(),mutate(t){t.chance&&(e=t.chance),n.mutate({rechargeTime:t.cooldownPerSpawn,units:t.maxSpawns})}}},at=e=>{const t=Math.hypot(e.x,e.y,e.z);return{x:e.x/t,y:e.y/t,z:e.z/t}},rt=e=>t=>e+t,st=e=>t=>{t.x*=e,t.y*=e,t.z*=e},it=e=>{const t=ze*ge,o=t/(ze-e.z);e.x=e.x*o,e.y=e.y*o},ct=(e,t)=>{const o=ze*ge,n=o/(ze-e.z);t.x=e.x*n,t.y=e.y*n},lt=()=>{},ht=()=>{},yt=()=>{};class xt{constructor({model:t,color:o,wireframe:n=!1}){const a=e(t.vertices),r=e(t.vertices),s=Ke(o),i=Qe(o,.4),c=t.polys.map(e=>({vertices:e.vIndexes.map(e=>a[e]),color:o,wireframe:n,strokeWidth:n?2:0,strokeColor:s,strokeColorDark:i,depth:0,middle:{x:0,y:0,z:0},normalWorld:{x:0,y:0,z:0},normalCamera:{x:0,y:0,z:0}})),l=t.polys.map(e=>({vertices:e.vIndexes.map(e=>r[e]),wireframe:n,normalWorld:{x:0,y:0,z:0}}));this.projected={},this.model=t,this.vertices=a,this.polys=c,this.shadowVertices=r,this.shadowPolys=l,this.reset()}reset(){this.x=0,this.y=0,this.z=0,this.xD=0,this.yD=0,this.zD=0,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.rotateXD=0,this.rotateYD=0,this.rotateZD=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.projected.x=0,this.projected.y=0}transform(){i(this.model.vertices,this.vertices,this.x,this.y,this.z,this.rotateX,this.rotateY,this.rotateZ,this.scaleX,this.scaleY,this.scaleZ),t(this.vertices,this.shadowVertices)}project(){ct(this,this.projected)}}const dt=[],mt=new Map(F.map(e=>[e,[]])),ut=new Map(F.map(e=>[e,[]])),ft=(()=>{function e(e,t){const o=t?ut:mt;let n=o.get(e).pop();return n||(n=new xt({model:y(l({recursionLevel:1,splitFn:h,scale:de})),color:e,wireframe:t}),n.color=e,n.wireframe=t,n.hit=!1,n.maxHealth=0,n.health=0),n}const t=nt({chance:.5,cooldownPerSpawn:1e4,maxSpawns:1});let o=!1;const n=nt({chance:.3,cooldownPerSpawn:12e3,maxSpawns:1}),a=nt({chance:.1,cooldownPerSpawn:1e4,maxSpawns:1}),r=[["x","y"],["y","z"],["z","x"]];return function(){o&&Le.game.score<=q?o=!1:!o&&Le.game.score>q&&(o=!0,n.mutate({maxSpawns:2}));let s=Je([N,U,B]),i=!1,c=1,l=3;const h=Le.game.cubeCount>=G&&Ye()&&a.shouldSpawn();Le.game.cubeCount>=H&&t.shouldSpawn()?(s=N,i=!0):Le.game.cubeCount>=O&&n.shouldSpawn()&&(s=R,c=3);const y=e(s,i);y.hit=!1,y.maxHealth=l,y.health=c,pt(y,0);const x=[.1*Math.random()-.05,.1*Math.random()-.05];h&&(x[0]=-.25,x[1]=0,y.rotateZ=Ge(0,qe));const d=Je(r);return x.forEach((e,t)=>{switch(d[t]){case"x":y.rotateXD=e;break;case"y":y.rotateYD=e;break;case"z":y.rotateZD=e}}),y}})(),pt=(e,t)=>{if(e.health+=t,!e.wireframe){const t=e.health-1,o=ue(e);for(let n of e.polys)n.strokeWidth=t,n.strokeColor=o}},zt=e=>{e.reset();const t=e.wireframe?ut:mt;t.get(e.color).push(e)},gt=[],wt=new Map(F.map(e=>[e,[]])),vt=new Map(F.map(e=>[e,[]])),Dt=(()=>{function t(e){const t=e.wireframe?vt:wt;let o=t.get(e.color).pop();return o||(o=new xt({model:c({scale:fe}),color:e.color,wireframe:e.wireframe}),o.color=e.color,o.wireframe=e.wireframe),o}const o=h({x:0,y:0,z:0},2*fe),n=e(o),a=e(o),r=e(o),s=o.map(at),l=e(s),y=o.length;return(e,c=1)=>{i(o,n,e.x,e.y,e.z,e.rotateX,e.rotateY,e.rotateZ,1,1,1),i(o,a,e.x-e.xD,e.y-e.yD,e.z-e.zD,e.rotateX-e.rotateXD,e.rotateY-e.rotateYD,e.rotateZ-e.rotateZD,1,1,1);for(let e=0;e<y;e++){const t=n[e],o=a[e],s=r[e];s.x=t.x-o.x,s.y=t.y-o.y,s.z=t.z-o.z}i(s,l,0,0,0,e.rotateX,e.rotateY,e.rotateZ,1,1,1);for(let o=0;o<y;o++){const a=n[o],s=r[o],i=l[o],h=t(e);h.x=a.x,h.y=a.y,h.z=a.z,h.rotateX=e.rotateX,h.rotateY=e.rotateY,h.rotateZ=e.rotateZ;const y=2*c,x=2*c,d=.015;h.xD=s.x+i.x*y+Math.random()*x,h.yD=s.y+i.y*y+Math.random()*x,h.zD=s.z+i.z*y+Math.random()*x,h.rotateXD=h.xD*d,h.rotateYD=h.yD*d,h.rotateZD=h.zD*d,gt.push(h)}}})(),bt=e=>{e.reset();const t=e.wireframe?vt:wt;t.get(e.color).push(e)},Mt=[],Et=[];let St;const kt=Re(".hud"),It=Re(".score-lbl"),Pt=Re(".cube-count-lbl");z(),Fe(Re(".pause-btn"),()=>C());const Ct=Re(".slowmo"),Xt=Re(".slowmo__bar"),Lt=Re(".menus"),Yt=Re(".menu--main"),Tt=Re(".menu--pause"),Zt=Re(".menu--score"),Wt=Re(".final-score-lbl"),jt=Re(".high-score-lbl");D(),Be(Re(".play-normal-btn"),()=>{I(ke),b(null),P()}),Be(Re(".play-casual-btn"),()=>{I(Ie),b(null),P()}),Be(Re(".resume-btn"),()=>X()),Be(Re(".menu-btn--pause"),()=>b(Pe)),Be(Re(".play-again-btn"),()=>{b(null),P()}),Be(Re(".menu-btn--score"),()=>b(Pe)),Be(Re(".play-normal-btn"),()=>{I(ke),b(null),P()}),Be(Re(".play-casual-btn"),()=>{I(Ie),b(null),P()}),Be(Re(".resume-btn"),()=>X()),Be(Re(".menu-btn--pause"),()=>b(Pe)),Be(Re(".play-again-btn"),()=>{b(null),P()}),Be(Re(".menu-btn--score"),()=>b(Pe)),window.addEventListener("keydown",e=>{"p"===e.key&&(We()?X():C())});let _t=0;const At=450,Nt={x:0,y:0},Ut={x:0,y:0},$t=1500;let Rt=0,Bt=0;const Ft=300;let Vt=1;if("PointerEvent"in window)pe.addEventListener("pointerdown",e=>{e.isPrimary&&W(e.clientX,e.clientY)}),pe.addEventListener("pointerup",e=>{e.isPrimary&&j()}),pe.addEventListener("pointermove",e=>{e.isPrimary&&_(e.clientX,e.clientY)}),document.body.addEventListener("mouseleave",j);else{let e=null;pe.addEventListener("touchstart",t=>{if(!J){const o=t.changedTouches[0];e=o.identifier,W(o.clientX,o.clientY)}}),pe.addEventListener("touchend",t=>{for(let o of t.changedTouches)if(o.identifier===e){j();break}}),pe.addEventListener("touchmove",t=>{for(let o of t.changedTouches)if(o.identifier===e){_(o.clientX,o.clientY),t.preventDefault();break}},{passive:!1})}Z(),window.lycoris.loading.hide()});