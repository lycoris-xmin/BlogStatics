$(function(){function t(){try{const t=$("script[page-data]").text();window.lycoris.post=JSON.parse(t)}catch(t){window.lycoris.post={},console.log(t)}}async function e(){try{const t=$.createHttpRequest();t.url="/post/markdown",t.data={id:window.lycoris.post.id};const e=await t.get();return e&&0==e.resCode&&e.data?e.data:""}catch(t){return""}}function o(t){try{const e={id:"cherry-markdown-container",value:t||"",editor:{codemirror:{theme:"default"},defaultModel:"previewOnly",convertWhenPaste:!0},engine:{global:{htmlWhiteList:"iframe|script|style"},syntax:{list:{listNested:!0},inlineCode:{theme:"red"},codeBlock:{theme:"dark",wrap:!0,lineNumber:!0}}},toolbars:{showToolbar:!1,autoScrollByHashAfterInit:!0}};l.cherry=new Cherry(e)}catch(t){}finally{$("div.cherry-dropdown,table.cherry-dropdown").remove(),$("div.cherry-toolbar").remove(),$("div.cherry-editor").remove(),setTimeout(()=>{$(".cherry-markdown-container").find("i.ch-icon-copy").each((t,e)=>{$(e).attr("title","复制"),$(e).parent().attr("title","复制")})},0)}}function i(){const t=[],e=document.querySelector("div.cherry-previewer").querySelectorAll("h1,h2");let o={};for(let i=0;i<e.length;i++){const n=e[i],a=`${n.tagName.toLocaleLowerCase()}-${i}`;n.setAttribute("id",a),o={level:parseInt(n.tagName.replace("H","")),id:a,text:n.innerText},t.length>0&&t[t.length-1].level<o.level?(t[t.length-1].child||(t[t.length-1].child=[]),t[t.length-1].child.push(o)):t.push(o)}const i=[];for(let e of t){let t={id:e.id,text:e.text,child:[]};e.child&&e.child.length&&(t.child=e.child.map(t=>({id:t.id,text:t.text}))),i.push(t)}return i}function n(t){function e(t){if(t){const e=$(`#${t}`);$("html, body").animate({scrollTop:e.offset().top-90},1e3,function(){e.addClass("focus-topic"),setTimeout(()=>{e.removeClass("focus-topic")},700)})}}if(t&&t.length){const o=l.barContainer.find("ul.topics");let i="";for(let e of t)if(i=i.concat(`<li class="first" data-id="${e.id}">${e.text}</li>`),e.child&&e.child.length)for(let t of e.child)i=i.concat(`<li class="second" data-id="${t.id}">${t.text}</li>`);o.html(i),o.find("li").on("click",function(){const t=$(this).data("id");e(t)})}}async function a(){try{const t=$.createHttpRequest();t.url="/post/previousandnext",t.data={id:window.lycoris.post.id};const e=await t.get();if(e&&0==e.resCode){const t=$(".prev-next");e.data&&(e.data.previous&&Object.keys(e.data.previous).length&&r(t.find("a.prev-post"),e.data.previous),e.data.next&&Object.keys(e.data.next).length&&r(t.find("a.next-post"),e.data.next),l.prev.destroy(),l.next.destroy(),e.data.next||e.data.previous||t.remove())}}catch(t){}}function r(t,e){t.find("p.title").text(e.title),t.find("img.icon").attr("src",e.icon),t.attr("href",`/post/${e.id}`),t.find("span.previous,span.next").text(t.hasClass("prev-post")?"上一篇":"下一篇")}async function c(){const t=$.createHttpRequest();t.url="/home/owner/publish",t.data={};const e=await t.get();if(e&&0==e.resCode){const t=$("div.statistics");t.find("span[post]").text(e.data.post),t.find("span[talk]").text(e.data.talk),t.find("span[category]").text(e.data.category),t.find("div.loading").removeClass("loading")}}function s(){const t=$(".cherry-previewer").find("img");if(t&&t.length){const e=[];t.each((t,o)=>{$(o).attr("data-index",t),$(o).attr("title",`图 - ${t+1}`),$(o).after(`<p style="text-align:center;font-weight:600;cursor:default">图 - ${t+1}</p>`),e.push($(o).attr("src"))});const o=$.lycorisImagePreviewer(e);t.on("click",function(){const t=$(this).attr("data-index");o.show(t)})}}const l={cherry:void 0,barContainer:$("div.bar-container"),toolContainer:$(".tool-container"),prev:$(".prev-post").lineBusy(),next:$(".next-post").lineBusy()};l.toolContainer.find("div.rocket").on("click",function(){$("html, body").animate({scrollTop:0},500)}),l.toolContainer.find("div.share").on("click",async function(){const t=`${window.lycoris.post.title}\r\n${window.location.href}\r\n作者：Lycoris - 程序猿的小破站`;await $.copyText(t),window.lycoris.totast.success("复制链接成功,感谢您的分享")}),this.init=async function(){l.prev.show(),l.next.show(),t();const r=await e();o(r);const d=i();n(d),window.lycoris.loading.hide(),$('[data-toggle="tooltip"]').lycorisTooltip(),s(),a(),c(),window.lycoris.record(document.title.replace(" - 程序猿的小破站",""),!0)},this.init()});