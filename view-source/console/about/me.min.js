$(function(){function t(t,n){if(s.skill.id){const i=$(`ul[data-type="${t}"]>li[data-id="${s.skill.id}"]`);i.find("span.name").text(n.name),i.find("span.value").text(n.proficiency);const a=s.skill.data[t].findIndex(t=>t.id==s.skill.id);return s.skill.data[t][a].name=n.name,s.skill.data[t][a].proficiency=n.proficiency,void console.log(s.skill.data[t])}const a=s.skill.data[t].length&&s.skill.data[t][s.skill.data[t].length-1].id?s.skill.data[t][s.skill.data[t].length-1].id+1:1;let e=`\n    <li class="flex-between-center" data-id="${a}">\n      <span class="name">${n.name}</span>\n      <div>\n        <span class="value">${n.proficiency}</span>\n        <span class="mdi mdi-pencil" data-toggle="tooltip" data-placement="top" title="修改"></span>\n        <span class="mdi mdi-delete" data-toggle="tooltip" data-placement="top" title="删除"></span>\n      </div>\n    </li>\n    `;const l=$(e);if(l.slideUp(),$(`ul[data-type="${t}"]`).append(l),l.slideDown(),s.skill.type&&s.skill.data[s.skill.type].length>0){const i=$(`ul[data-type="${t}"]`).find("li.empty");i.remove();const n=$(`ul[data-type="${t}"]`).children("li").detach();n.sort(function(t,i){return parseInt($(i).find(".value").text(),10)-parseInt($(t).find(".value").text(),10)}),$(`ul[data-type="${t}"]`).empty().append(i).append(n)}l.find(".mdi-pencil").on("click",function(){const t=$(this).parent().parent();s.skill.type=t.parent().data("type"),s.skill.id=t.data("id"),s.skill.name=t.find("span.name").text(),s.skill.proficiency=parseFloat(t.find("span.value").text()),i()}),l.find(".mdi-delete").on("click",async function(){const t=await window.lycoris.swal.confirm("确定要移除吗?");if(t){const t=$(this).parent().parent();t.slideUp(function(){const t=$(this).parent().data("type"),i=parent.find("span.name").text();$(this).remove(),s.skill.data[t]=s.skill.data[t].filter(t=>t.name!=i)})}}),s.skill.data[t].push({id:a,...n})}function i(){let t=n(s.skill.type);c.skill.find(".modal-title").text(`新增${t}`),c.skill.find("label[type]").text(`${t}名称`),c.skill.show()}function n(t){let i="其他";return"code"==t?i="语言":"frame"==t?i="框架":"sql"==t&&(i="数据库"),i}function a(t){const i="qq-qrcode"==$(this).attr("name")?"qq":"wechat",n=$(`<img src="${t}" onerror="javascript:this.src='/statics/images/404.png'" data-toggle="tooltip" data-placement="top" title="" data-original-title="点击更换" ${i}>`);$(this).next().prepend(n),n.tooltip(),n.on("click",function(){$(this).parent().prev().trigger("click")})}async function e(){const t=window.lycoris.createRequest();t.url="/user/brief";const i=await t.get();return i&&0==i.resCode?i.data:{}}async function l(t){const i=window.lycoris.createRequest();i.url=`/about/me/${t}`;const n=await i.get();return n&&0==n.resCode?n.data:{}}async function o(){const i=await e();$("div.brief").formAutoFill(i);const n=await l("info");$("div.info").formAutoFill(n,{taginput:t=>{$(t).tagsInput({height:$(t).data("height")?$(t).data("height"):"40px",width:"100%",defaultText:$(t).attr("placeholder"),removeWithBackspace:!0,delimiter:[","],maxTags:8,maxLimit:function(){window.lycoris.totast.warn("标签最多只能添加八个")}})}});const o=await l("skill");for(let i in o)if(o[i].length)for(let n of o[i])t(i,n);const c=await l("contact");c.qq&&a.call($("div.contact").find('input[name="qq-qrcode"]'),c.qq),c.weChat&&a.call($("div.contact").find('input[name="weChat-qrcode"]'),c.weChat)}const c={skill:$("#skill-Modal").bootstrapModal()},s={skill:{type:"",id:"",name:"",proficiency:100,data:{code:[],frame:[],sql:[],other:[]}},contact:{qrcode:{qq:void 0,weChat:void 0}}},d=$("body").busy();$("div.card-header>.btn-secondary").on("click",async function(){const t=await window.lycoris.swal.confirm("确定要关闭当前页面吗？");t&&$("body").fadeOut(()=>{window.parent.lycoris.multitabs.remove(location.pathname)})}),$('textarea[name="introduction"]').on("input",function(){const t=$(this).val().length,i=$(this).next().find("span");i.text(t),t>=parseInt($(this).attr("maxlength"))?i.css("color","var(--color-danger)"):i.css("color","var(--color-dark-light)")}),$(".skill-item").find(".mdi-plus").on("click",function(){s.skill.type=$(this).data("type"),i()}),c.skill.find('input[name="proficiency"]').on("input",$.debounce(function(){const t=$(this).val();let i=parseInt(t);isNaN(i)||$(this).val()<0?$(this).val(0):i>100&&$(this).val(100)},500)),c.skill.handleShow(function(){$(this).find('input[name="name"]').val(s.skill.name),$(this).find('input[name="proficiency"]').val(s.skill.proficiency)}),c.skill.handleShown(function(){$(this).find('input[name="name"]').focus()}),c.skill.handleHidden(function(){s.skill.id="",s.skill.name="",s.skill.proficiency=100}),c.skill.find("button[save]").on("click",function(){const i=c.skill.find(".modal-body").toJson();if(s.skill.id>0){const t=s.skill.data[s.skill.type].filter(t=>t.id==s.skill.id)[0];if(t.name==i.name&&t.proficiency==i.proficiency)return void c.skill.hide()}if(!i.name)return void window.lycoris.totast.warn(`${n(s.skill.type)}名称： 不能为空`);if(""==i.proficiency||0==i.proficiency)return void window.lycoris.totast.warn("掌握度不能为空或0");const a=s.skill.data[s.skill.type].filter(t=>t.name==i.name&&t.id!=s.skill.id);a&&a.length?window.lycoris.totast.warn(`${n(s.skill.type)}名称： ${i.name} 已添加`):(i.proficiency=parseInt(i.proficiency),t(s.skill.type,i),c.skill.hide())}),$(".contact").find(".qrcode>.empty,.qrcode>img").on("click",function(){$(this).parent().prev().trigger("click")}),$(".contact").find('input[name="qq-qrcode"],input[name="weChat-qrcode"]').on("change",function(){const t=$(this).attr("name");"qq-qrcode"==t?s.contact.qrcode.qq=$(this)[0].files[0]:s.contact.qrcode.weChat=$(this)[0].files[0];const i=window.lycoris.tool.createObjectURL($(this)[0].files[0]),n=$(this).next().find("img");n&&n.length?n.attr("src",i):a.call(this,i)}),$(".contact").find(".btn-outline-danger").on("click",async function(){const t=await window.lycoris.swal.confirm("确定要移除展示吗？");if(t){const t=$(this).parent().prev().find("img");t.fadeOut(function(){$(this).remove()})}}),$("div.card-header>.btn-info").on("click",async function(){const t=$("div.brief").toJson(),i=$("div.info").toJson(),n=s.skill.data,a={qq:"",weChat:""};d.show("数据提交中,请稍候...");try{if(s.contact.qrcode.qq){const t=await window.lycoris.fileUpload(s.contact.qrcode.qq,100,"qq.webp");if(!t||0!=t.resCode)return;a.qq=t.data.url,s.contact.qrcode.qq=void 0}else{const t=$("div.contact").find("img[qq]");t&&t.length&&(a.qq=t.attr("src"))}if(s.contact.qrcode.weChat){const t=await window.lycoris.fileUpload(s.contact.qrcode.weChat,100,"wechat.webp");if(!t||0!=t.resCode)return;a.weChat=t.data.url,s.contact.qrcode.weChat=void 0}else{const t=$("div.contact").find("img[wechat]");t&&t.length&&(a.weChat=t.attr("src"))}const e=window.lycoris.createRequest();e.url="/about/me/save",e.data={brief:t,info:i,skill:n,contact:a};const l=await e.post();l&&0==l.resCode&&window.lycoris.totast.success("保存成功")}finally{d.hide()}}),this.init=async function(){await o(),window.lycoris.loading.hide(),$('[data-toggle="tooltip"]').tooltip()},this.init()});