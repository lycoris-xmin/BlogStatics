$(function(){async function e(){a.busy.show("Cherry-Markdown 插件初始化中,请稍候...");try{const e=Cherry.createMenuHook("网站附件",{iconName:"toc",onClick:function(){window.lycoris.events.call("static-file-Modal.show",{uploadType:2},e=>{if(e&&e.length)for(let t of e){let e="\r\n";0==t.fileType?e+=`![图片#B #S #R #60% #auto #center](${t.url})`:1==t.fileType?e+=`!audio[音频#center](${t.url})`:2==t.fileType?e+=`!video[视频#B #S #R #center](${t.url})`:e+=`[${t.fileName}](${t.url})`,a.instance.insert(e)}})}}),i={id:"cherry-markdown-container",value:"",editor:{codemirror:{theme:"default"},defaultModel:"edit&preview",convertWhenPaste:!0},engine:{global:{htmlWhiteList:"iframe|script|style"},syntax:{list:{listNested:!0},inlineCode:{theme:"red"},codeBlock:{theme:"dark",wrap:!0,lineNumber:!0}}},toolbars:{theme:"light ",showToolbar:!0,toolbar:["bold","size","color","header","|","hr","strikethrough","|","code","link","table","|","list",{insert:["serverFile","image","audio","video","formula"]},"graph","togglePreview"],sidebar:[],bubble:!1,float:!1,customMenu:{serverFile:e},autoScrollByHashAfterInit:!0},fileUpload:async(e,t)=>{a.busy.show("文件上传中,请稍候...");try{const i=await window.lycoris.fileUpload(e,20);i&&0==i.resCode&&(0==i.data.fileType?t(i.data.url,{name:"图片",isBorder:!0,isShadow:!0,isRadius:!0,width:"60%",height:"auto"}):1==i.data.fileType?t(i.data.url,{name:"音频"}):2==i.data.fileType?t(i.data.url,{name:"视频",isBorder:!0,isShadow:!0,isRadius:!0}):t(i.data.url))}catch{}finally{a.busy.hide()}},callback:{}};return i.value=await t(),o.markdown=i.value,new Cherry(i)}finally{a.busy.hide()}}async function t(){try{const e=window.lycoris.createRequest();e.url="/about/web/markdown";const t=await e.get();return t&&0==t.resCode&&t.data||""}catch(e){return""}}const a={instance:void 0,busy:$("div.card-body").busy()},i={save:$(".card-header").find("button.btn-info"),close:$(".card-header").find("button.btn-secondary")},o={markdown:""};i.save.on("click",async function(){const e=a.instance.getMarkdown();if(e)if(e!=o.markdown){$(this).setBusy();try{const t=window.lycoris.createRequest();t.url="/about/web/save",t.data={value:e};const a=await t.post();a&&0==a.resCode&&(window.lycoris.totast.success("保存成功"),o.markdown=e)}finally{$(this).clearBusy()}}else window.lycoris.totast.success("保存成功");else window.lycoris.totast.warn("内容不能为空")}),i.close.on("click",function(){$("body").fadeOut(()=>{window.parent.lycoris.multitabs.remove(location.pathname)})}),this.init=async function(){window.lycoris.loading.hide(),a.instance=await e()},this.init()});