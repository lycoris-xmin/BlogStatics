$(function(){async function t(t,n){const i=window.lycoris.createRequest();i.url=`${e}/list`,i.data={pageIndex:t,pageSize:n};const o=await i.get();return o&&0==o.resCode?o.data:{}}function n(){i.options.toolbar=".table-tool",i.options.showCheckbox=!1,i.options.showColumns=!1,i.options.autoHeight=!0,i.options.resize=!0,i.pageOptions.pageSize=10,i.pageOptions.pageList=[10,20,50],i.columns=[{column:"icon",title:"分类封面图",align:"center",class:"cell-icon",render:function(t){return`\n          <div class="flex-center-center">\n            <img src="${t}" onerror="javascript:this.src='/statics/images/404.png'"/>\n          </div>\n          `}},{column:"name",title:"分类标题",class:"cell-name",render:function(t){return`<p>${t}</p>`}},{column:"keyword",title:"分类关键词",class:"cell-keyword",render:function(t,n){if(t&&t.length){let n="";return[...t].forEach(t=>{n=n.concat(`<span class="badge badge-info">${t}</span>`)}),n}return"-"}},{column:"postCount",title:"文章数",width:"120px"},{column:"createTime",title:"创建时间",width:"180px"},{column:"action",title:"操作",class:"cell-action action-2",align:"center",render:function(t,n,e){let i='\n          <button class="update" data-toggle="tooltip" data-placement="top" title="编辑">\n            <i class="mdi mdi-pencil"></i>\n          </button>\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          ';return i},events:{"click .update":function(t,n,e,i){Object.assign(c,e),c.index=i,a.show()},"click .delete":async function(t,n,o,a){const s=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(s){$(t.currentTarget).attr("disabled","disabled");try{const n=window.lycoris.createRequest();n.url=`${e}/delete`,n.data={id:o.id};const a=await n.post();a&&0==a.resCode&&(window.lycoris.totast.success("删除成功"),i.removeRow("id",o.id))}finally{$(t.currentTarget).removeAttr("disabled")}}}}}],i.init(),i.request=t,i.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip()})}const e="/post/category",i=$("#tb_departments").table(),o={create:$(".table-tool").find("button.btn-info"),search:$(".table-tool").find("button.btn-success")},a=$("#carete-ou-update-Modal").bootstrapModal(),s=$("#keyword-tags").jqueryTagInput();let c={index:-1};o.create.on("click",function(){a.show()}),o.search.on("click",async function(){$(this).setBusy();try{await i.load()}finally{$(this).clearBusy()}}),a.handleShow(()=>{const t=a.find("form");c.index>-1?(t.find('input[name="id"]').val(c.id),t.find('input[name="icon"]').val(c.icon),t.find('input[name="name"]').val(c.name),s.set(c.keyword),c.icon&&(t.find(".icon").removeClass("create"),t.find("img").attr("src",c.icon)),a.find(".modal-title").text(`修改分类(${c.id})`)):(s.set(),a.find(".modal-title").text("新增分类"))}),a.handleHidden(()=>{c.index=-1;const t=a.find("form");t.find('input[name="id"]').val(""),t.find('input[name="icon"]').val(""),t.find('input[name="name"]').val(""),t.find('input[name="keywords"]').val(""),t.find("div.icon").hasClass("create")||t.find("div.icon").addClass("create")}),a.find("button.folder").on("click",function(){window.lycoris.events.call("static-file-Modal.show",{fileType:0,uploadType:10,multiple:!1},t=>{const n=a.find("form");n.find("img").attr("src",t[0].url),n.find('input[name="icon"]').val(t[0].url),n.find("div.icon").removeClass("create")})}),a.find("button[save]").on("click",async function(){const t=a.find("form").toJson();$(this).setBusy();try{const n=window.lycoris.createRequest();n.url=`${e}/${c.index>-1?"update":"create"}`,n.data={...t},-1==c.index&&delete n.data.id;const o=await n.post();o&&0==o.resCode&&(window.lycoris.totast.success("保存成功"),c.index>-1?i.updateRow(c.index,o.data):i.createRow(o.data),a.hide())}finally{$(this).clearBusy()}}),this.init=async function(){n(),window.lycoris.loading.hide(),await i.load()},this.init()});