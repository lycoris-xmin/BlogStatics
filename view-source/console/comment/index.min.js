$(function(){async function t(t,e){const s=window.lycoris.createRequest();s.url=`${n}/list`,s.data={pageIndex:t,pageSize:e};const a=$("div.filter-panel").toJson();a.content&&(s.data.content=a.content),a.postId&&(s.data.postId=postId),a.userId&&(s.data.userId=userId),a.status&&(s.data.status=a.status);const i=await s.get();return i&&0==i.resCode?i.data:{}}function e(){s.options.toolbar=".table-tool",s.options.showCheckbox=!0,s.options.showColumns=!1,s.options.autoHeight=!0,s.options.resize=!0,s.pageOptions.pageSize=20,s.pageOptions.pageList=[20,50],s.columns=[{column:"content",title:"评论内容",class:"cell-content",render:function(t){return`<p class="content">${t}</p>`}},{column:"title",title:"评论文章",class:"cell-content",width:"300px",render:function(t,e){return e.postId>0?`<a class="title content" href="/post/${e.postId}" target="_blank">${t}</a>`:`<span class="badge badge-secondary">${t}</span>`}},{column:"userName",title:"评论用户",width:"150px",render:function(t,e){return e.isOwner?`<span class="badge badge-info">${t}</span>`:"用户已注销"==t?`<span class="badge badge-secondary">${t}</span>`:t}},{column:"createTime",title:"评论时间",width:"180px"},{column:"status",title:"状态",width:"100px",render:function(t){return 0==t?'<span class="badge badge-secondary">正常</span>':1==t?'<span class="badge badge-danger">违规</span>':'<span class="badge badge-warning">用户删除</span>'}},{column:"ip",title:"IP地址",width:"150px"},{column:"ipAddress",title:"IP归属地",width:"200px"},{column:"action",title:"操作",class:"cell-action action-2",align:"center",render:function(t,e,n){let s='\n          <button class="info" data-toggle="tooltip" data-placement="top" title="详细信息">\n            <i class="mdi mdi-eye"></i>\n          </button>\n          ';return s=s.concat('\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>'),s},events:{"click .info":function(t,e,n,s){i.find("p.content").text(n.content);const a=i.find("a.post");a.text(n.title),a.attr("href",`/post/${n.postId}`),i.find("p.user").text(n.userName),i.find("p.time").text(n.createTime),i.find("p.userAgent").text(n.userAgent),i.find("p.ip").text(n.ip),i.find("p.ipAddress").text(n.ipAddress),i.show()},"click .delete":async function(t,e,a,i){const o=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(o){$(t.currentTarget).attr("disabled","disabled");try{const e=window.lycoris.createRequest();e.url=`${n}/delete`,e.data={ids:[a.id]};const i=await e.post();i&&0==i.resCode&&(window.lycoris.totast.success("删除成功"),s.removeRow("id",a.id))}finally{$(t.currentTarget).removeAttr("disabled")}}}}}],s.init(),s.request=t,s.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip()})}const n="/post/comment",s=$("#tb_departments").table(),a={search:$(".table-tool").find("button.btn-success")},i=$("#viewDetail-Modal").bootstrapModal();a.search.on("click",async function(){$(this).setBusy();try{await s.load()}finally{$(this).clearBusy()}}),this.init=async function(){e(),window.lycoris.loading.hide(),await s.load()},this.init()});