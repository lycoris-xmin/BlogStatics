$(function(){async function e(){d.staticFile.find(".loading-preloader").addClass("loading");try{await i(),a(),l(),r.lastFileType=r.fileType}finally{d.staticFile.find(".loading-preloader").removeClass("loading")}}async function i(){const e=window.lycoris.createRequest();e.url="/staticfile/repository",e.data={pageIndex:r.pageIndex,pageSize:r.pageSize},null!=r.fileType&&"number"==typeof r.fileType&&(e.data.fileType=r.fileType);const i=await e.get();i&&0==i.resCode&&(r.count=i.data.count,r.list=i.data.list)}function a(){r.maxPageIndex=$.getMaxPageIndex(r.count,r.pageSize);let e="";if(r.count>0)for(let i of r.list)if(0==i.fileType)e+=`\n          <div class="file-card" data-url="${i.url}" data-name="${i.fileName}" data-filetype="${i.fileType}">\n            <img src="${i.url}" />\n            <p>${i.fileName}</p>\n            <div class="overlay">\n              <div class="flex-end-center">\n                <i class="mdi mdi-24px mdi-eye"></i>\n                <i class="mdi mdi-24px mdi-check-circle"></i>\n              </div>\n            </div>\n          </div>\n          `;else if(1==i.fileType)e+=`\n          <div class="file-card" data-url="${i.url}" data-name="${i.fileName}" data-filetype="${i.fileType}">\n            <div class="file flex-center-center">\n              <audio src="${i.url}" controls="controls"></audio>\n            </div>\n            <p>${i.fileName}</p>\n            <div class="overlay">\n              <div class="flex-end-center">\n                <i class="mdi mdi-24px mdi-eye"></i>\n                <i class="mdi mdi-24px mdi-check-circle"></i>\n              </div>\n            </div>\n          </div>\n          `;else if(2==i.fileType)e+=`\n          <div class="file-card" data-url="${i.url}" data-name="${i.fileName}" data-filetype="${i.fileType}">\n            <div class="file flex-center-center">\n              <video src="${i.url}" controls="controls"></video>\n            </div>\n            <p>${i.fileName}</p>\n            <div class="overlay">\n              <div class="flex-end-center">\n                <i class="mdi mdi-24px mdi-eye"></i>\n                <i class="mdi mdi-24px mdi-check-circle"></i>\n              </div>\n            </div>\n          </div>\n          `;else{let a="mdi-file-document-box-outline",t="";i.url.endsWith(".zip")||i.url.endsWith(".rar")||i.url.endsWith(".7z")?(a="mdi-folder-zip",t="压缩文件"):i.url.endsWith(".html")?(a="mdi-language-html5",t="html文件"):i.url.endsWith(".js")?(a="mdi-language-javascript",t="js文件"):i.url.endsWith(".css")?(a="mdi-language-css3",t="css样式文件"):i.url.endsWith(".pdf")&&(a="mdi-file-pdf-box",t="pdf文件"),e+=`\n          <div class="file-card" data-url="${i.url}" data-name="${i.fileName}" data-filetype="${i.fileType}">\n            <div class="file flex-center-center">\n              <span class="mdi ${a}"></span>\n              ${t?`<span>${t}</span>`:""}\n            </div>\n            <p>${i.fileName}</p>\n            <div class="overlay">\n              <div class="flex-end-center">\n                <i class="mdi mdi-24px mdi-eye"></i>\n                <i class="mdi mdi-24px mdi-check-circle"></i>\n              </div>\n            </div>\n          </div>\n          `}o.html(e),o.find("img").on("error",function(){$(this).attr("src","/statics/images/404.png")});const i=d.staticFile.find(".footer-pagination"),a=(r.pageIndex-1)*r.pageSize+1;r.pageIndex<r.maxPageIndex?i.find("span.current").text(`${a} - ${r.pageIndex*r.pageSize}`):i.find("span.current").text(`${a} - ${a+r.list.length-1}`),r.list.length>0&&r.maxPageIndex>1?i.show():i.hide(),i.find("span.total").text(r.count),i.addClass("show"),i.find(".pagination-btn").addClass("show"),t()}function t(){const e=o.find(">div.file-card");e.on("click",function(){const e="1"==$(this).data("active"),i=$(this).data("url"),a=$(this).data("filetype"),t=$(this).data("name");if(r.multiple)e?($(this).data("active","0"),$(this).removeClass("active"),r.active=r.active.filter(e=>e.url!=i)):($(this).data("active","1"),$(this).addClass("active"),r.active.push({url:i,fileType:a,fileName:t}));else{if(e)return;const t=o.find(">div.active");t.removeClass("active"),t.data("active","0"),$(this).data("active","1"),$(this).addClass("active"),r.active=[{url:i,fileType:a}]}}),e.find("i.mdi-eye").on("click",function(e){e.stopPropagation();const i=$(this).parent().parent().parent().data("url");r.eye=r.list.filter(e=>e.url==i)[0],d.staticFileDetail.modal("show")})}function l(e){function i(){let i=1,a=0;r.maxPageIndex>r.maxPageNumber?e<=3?(i=1,a=r.maxPageNumber):e+3>r.maxPageIndex?(i=r.maxPageIndex-r.maxPageNumber,a=r.maxPageIndex):(i=Math.max(1,e-3),a=Math.min(r.maxPageIndex,e+3)):(i=1,a=r.maxPageIndex);const t=[];for(let e=i;e<=a;e++)t.push(e);return t}const a=d.staticFile.find(".pagination");e=e||1;const t=i();let l='\n    <li class="page-item page-btn" data-index="-1">\n      <span class="page-link">上一页</span>\n    </li>\n    ';for(let e of t)l+=`\n      <li class="page-item page-number ${e==r.pageIndex?"active":""}" data-index="${e}">\n        <span class="page-link">${e}</span>\n      </li>\n      `;l+='\n    <li class="page-item page-btn" data-index="1">\n      <span class="page-link">下一页</span>\n    </li>\n    ',a.html(l),n()}function n(){const e=d.staticFile.find(".pagination");e.find(">li.page-number").on("click",async function(){const t=$(this).data("index");if(r.pageIndex!=t){r.pageIndex=t,r.maxPageIndex>r.maxPageNumber?l($(this).data("index")):(e.find(">li.page-number").removeClass("active"),$(this).addClass("active")),d.staticFile.find(".loading-preloader").addClass("loading");try{await i(),a()}finally{d.staticFile.find(".loading-preloader").removeClass("loading")}}}),e.find(">li.page-btn").on("click",function(){const i=parseInt($(this).data("index"));let a=r.pageIndex+i;a<1||a>r.maxPageIndex||e.find(`>li.page-number[data-index="${a}"]`).trigger("click")})}function s(){window.screen.width>1920?(r.pageSize=15,r.maxPageNumber=7):window.screen.width>1368?(r.pageSize=12,r.maxPageNumber=5):window.screen.width>768&&(r.pageSize=8,r.maxPageNumber=5)}const d={staticFile:$("#static-file-Modal"),staticFileDetail:$("#static-file-detail-Modal")},c=$('select[name="fileType"]'),o=d.staticFile.find(".static-file-card-group"),p=d.staticFile.find('input[type="file"]'),f=d.staticFile.find("button.upload"),r={lastFileType:void 0,fileType:"",active:[],count:0,list:[],maxPageIndex:0,pageIndex:1,pageSize:15,uploadType:99,multiple:!0,eye:0,fileTypeEnum:{0:"图片",1:"音频",2:"视频",3:"文件"},selectedCallback:void 0,maxPageNumber:7};d.staticFile.on("shown.bs.modal",()=>{null!=r.lastFileType&&r.lastFileType===r.fileType||e()}),d.staticFile.on("hidden.bs.modal",()=>{o.find(".img-card").removeClass("active"),r.active=[]}),d.staticFileDetail.on("shown.bs.modal",()=>{let e="";e=0==r.eye.fileType?`\n      <img class="file-img" src="${r.eye.url}"  onerror="javascript:this.src='/statics/images/404.png'" />\n      `:1==r.eye.fileType?`\n      <div class="file-audio flex-center-center">\n        <audio  src="${r.eye.url}" controls="controls"/>\n      </div>\n      `:2==r.eye.fileType?`\n      <video class="file-video" src="${r.eye.url}" controls="controls"/>\n      `:"\n      <div>\n        <span>文件</span>\n      </div>;\n      ",d.staticFileDetail.find("div.file").html(e),d.staticFileDetail.find(".file-name").find("span.value").text(r.eye.fileName),d.staticFileDetail.find(".file-type").find("span.value").text(r.fileTypeEnum[r.eye.fileType]),d.staticFileDetail.find(".file-size").find("span.value").text(r.eye.fileSize);const i=d.staticFileDetail.find(".file-link").find("a.value");i.attr("href",r.eye.url),i.text(r.eye.url)}),c.on("change",function(){r.fileType=$(this).val(),""!=r.fileType&&(r.fileType=parseInt(r.fileType)),r.pageIndex=1,e(),0==r.fileType?p.attr("accept",".jpg,.png,.gif,.jpeg"):1==r.fileType?p.attr("accept","audio/*"):2==r.fileType?p.attr("accept","video/*"):p.attr("accept","*")}),f.on("click",function(){p.trigger("click")}),p.on("change",async function(){f.attr("disabled","disabled"),f.addClass("loading");try{const e=$(this)[0].files[0],i=await window.lycoris.fileUpload(e,r.uploadType);i&&0==i.resCode&&1==r.pageIndex&&(""!=r.fileType&&r.fileType!=i.data.fileType||(r.list.length==r.pageSize&&r.list.pop(),r.list.unshift(i.data),r.count++,a()))}finally{f.removeAttr("disabled"),f.removeClass("loading")}}),d.staticFile.find("button.refresh").on("click",e),d.staticFile.find("button.save").on("click",function(){r.selectedCallback&&"function"==typeof r.selectedCallback&&r.selectedCallback([...r.active]),d.staticFile.modal("hide")}),this.init=(()=>{s(),window.lycoris.events.on("static-file-Modal.show",({uploadType:e,fileType:i,multiple:a=!0},t)=>{null!=i&&"number"==typeof i&&(r.fileType=i,d.staticFile.find("div.static-file-header").find(".bootstrap-select").hide()),r.uploadType=e,r.multiple=a,r.selectedCallback=t,d.staticFile.modal("show")}),window.onresize=(()=>{s(),r.lastFileType=void 0})}),this.init()});