$(function(){async function t(t,e){const n=window.lycoris.createRequest();n.url=`${a}/list`,n.data={pageIndex:t,pageSize:e};const i=$("div.filter-panel").toJson();i.name.trim()&&(n.data.name=i.name.trim()),null!=i.status&&i.status>=0&&(n.data.status=i.status);const o=$(".filter-panel").toJson();for(let t in o){const e=o[t];(e||"number"==typeof e)&&(n.data[t]=o[t])}const s=await n.get();return s&&0==s.resCode?s.data:{}}function e(){n.options.toolbar=".table-tool",n.options.showCheckbox=!1,n.options.showColumns=!1,n.options.autoHeight=!0,n.options.resize=!0,n.options.pageSizeResize=!0,n.columns=[{column:"logo",title:"网站Logo",width:"100px",render:function(t,e){return`<div class="flex-center-center">\n                    <img class="logo" src="${t}" title="${e.name}" onerror="javascript:this.src='/statics/images/404.png'"/>\n                  </div>`}},{column:"name",title:"网站名称",width:"350px",render:function(t,e){return t}},{column:"link",title:"网站链接",render:function(t,e){return`<a class="link" href="${t}" target="_blank">${t}</a>`}},{column:"status",title:"状态",width:"100px",align:"center",render:function(t){return 0==t?'<span class="badge badge-secondary">未审核</span>':1==t?'<span class="badge badge-success">通过</span>':'<span class="badge badge-danger">拒绝</span>'}},{column:"createUserName",title:"创建用户",width:"200px"},{column:"createTime",title:"申请时间",width:"180px"},{column:"action",title:"操作",class:"cell-action action-2",align:"center",render:function(t,e,a){let n="";return n=1!=e.status?n.concat('\n          <button class="info" data-toggle="tooltip" data-placement="top" title="审核">\n            <i class="mdi mdi-checkbox-marked-circle"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          '):n.concat('\n          <button class="warning" data-toggle="tooltip" data-placement="top" title="编辑">\n            <i class="mdi mdi-pencil"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          '),n=n.concat('\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n        '),n},events:{"click .warning":function(t,e,a,n){r.index=n,r.row=a,o.createorupdate.show(),o.createorupdate.find(".modal-title").text(`编辑友情链接(${a.id})`)},"click .info":function(t,e,a,n){r.index=n,r.row=a,o.audit.show()},"click .delete":async function(t,e,i,o){const s=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(s){$(t.currentTarget).setBusy();try{const e=window.lycoris.createRequest();e.url=`${a}/delete`,e.data={id:i.id};const o=await e.post();o&&0==o.resCode&&(window.lycoris.totast.success("删除成功"),n.removeRow("id",i.id))}finally{$(t.currentTarget).clearBusy()}}}}}],n.init(),n.request=t,n.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip()})}const a="/friendly",n=$("#tb_departments").table(),i={create:$(".table-tool").find("button.btn-info"),search:$(".table-tool").find("button.btn-success")},o={createorupdate:$("#createorupdate-Modal").bootstrapModal(),audit:$("#audit-Modal").bootstrapModal()},s=o.audit.find('select[name="status"]').bootstrapSelectpicker(),r={index:-1,row:{}};i.search.on("click",async function(){$(this).setBusy();try{await n.load()}finally{$(this).clearBusy()}}),i.create.on("click",function(){o.createorupdate.show()}),o.createorupdate.handleShow(()=>{r.index>-1&&null!=r.row.id&&$(this).find("input,textarea").each((t,e)=>{const a=$(e).attr("name");r.row[a]&&$(e).val(r.row[a])})}),o.audit.handleShow(()=>{r.index>-1&&null!=r.row.id&&s.set(r.row.status),o.audit.find("textarea").val(r.row.remark||"")}),o.createorupdate.handleHidden(()=>{$(this).find("input,textarea").each((t,e)=>{$(e).val("")}),r.index=-1,r.row={},o.createorupdate.find(".modal-title").text("新增友情链接")}),o.audit.handleHidden(()=>{r.index=-1,r.row={},s.set("1"),o.audit.find("textarea").val("")}),o.createorupdate.find("button[save]").on("click",async function(){const t=o.createorupdate.find("form").toJson();if(t.link)if($.regex.url(t.link))if(t.logo)if($.regex.url(t.logo))if(t.name){$(this).setBusy();try{const e=window.lycoris.createRequest();e.url=r.index>-1?`${a}/update`:`${a}/create`,e.data={...t},r.index>-1&&(e.data.id=r.row.id);const i=await e.post();i&&0==i.resCode&&(window.lycoris.totast.success("保存成功"),-1==r.index?n.createRow(i.data,!1):n.updateRow(r.index,i.data),o.createorupdate.hide())}finally{$(this).clearBusy()}}else window.lycoris.totast.warn("网站名称不能为空");else window.lycoris.totast.warn("网站Logo链接格式错误");else window.lycoris.totast.warn("网站Logo链接不能为空");else window.lycoris.totast.warn("网站链接格式错误");else window.lycoris.totast.warn("网站链接不能为空")}),o.audit.find("button[save]").on("click",async function(){const t={id:r.row.id,status:s.getValue(),remark:o.audit.find("textarea").val()};$(this).setBusy();try{const e=window.lycoris.createRequest();e.url=`${a}/audit`,e.data={...t};const i=await e.post();i&&0==i.resCode&&(window.lycoris.totast.success("保存成功"),r.row.status=t.status,r.row.remark=t.remark,n.updateRow(r.index,r.row),o.audit.hide())}finally{$(this).clearBusy()}}),this.init=function(){e(),window.lycoris.loading.hide(),n.load()},this.init()});