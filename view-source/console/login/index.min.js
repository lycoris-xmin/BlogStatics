$(function(){function t({email:t,password:o}){const a=$.createHttpRequest();return a.url="/authentication/login/validate",a.data={email:t,password:o},a.post()}function o({email:t,oathCode:o,remember:a}){const s=$.createHttpRequest();return s.url="/authentication/login/oathcode",s.data={email:t,oathCode:o,remember:a},s.post()}const a={email:$('input[name="email"]'),password:$('input[name="password"]'),btn:$(".login-btn")};a.email.on("focus",function(){$(this).parent().addClass("focus")}),a.email.on("blur",function(){$(this).val()||$(this).parent().removeClass("focus")}),a.password.on("focus",function(){$(this).parent().addClass("focus")}),a.password.on("blur",function(){$(this).val()||$(this).parent().removeClass("focus"),this.type="password"}),a.btn.on("click",async function(){$(this).setBusy();const a=$(".login-container").toJson();try{let s=await t(a);s&&0==s.resCode&&(s=await o({email:a.email,oathCode:s.data.oathCode,remember:a.remember}),s&&0==s.resCode&&(location.href=`${window.lycoris.console}/dashboard`))}finally{$(this).clearBusy()}}),this.init=function(){window.top==window.self?($("div.bg").removeClass("loading"),window.lycoris.totast=$.totast):(window.parent.lycoris.totast.warn("登录已过期，请重新登录"),setTimeout(()=>{window.parent.location.href=`${window.lycoris.console}/authentication/login`},1e3)),setTimeout(()=>{a.email.val()&&a.email.parent().addClass("focus"),a.password.val()&&a.password.parent().addClass("focus")},500)},this.init()});