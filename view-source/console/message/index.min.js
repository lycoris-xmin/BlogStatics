$(function(){async function t(t,n){const i=window.lycoris.createRequest();i.url=`${e}/list`,i.data={pageIndex:t,pageSize:n};const o=$(".filter-panel").toJson();for(let t in o){const n=o[t];(n||"number"==typeof n)&&(i.data[t]=o[t])}const s=await i.get();return s&&0==s.resCode?s.data:{}}function n(){i.options.toolbar=".table-tool",i.options.showCheckbox=!1,i.options.showColumns=!1,i.options.autoHeight=!0,i.options.resize=!0,i.options.pageSizeResize=!0,i.columns=[{column:"content",title:"留言展示内容",render:function(t,n){return`<p class="message-content ${n.originalContent?"original-content":""}">${t}</p>`}},{column:"createUser",title:"留言用户",width:"150px",render:function(t,n){return n.isOwner?`<span class="badge badge-info">${t}</span>`:t}},{column:"status",title:"状态",align:"center",width:"100px",render:function(t,n){return n.originalContent?'<span class="badge badge-dark">待审核</span>':0==t?'<span class="badge badge-success">正常</span>':1==t?'<span class="badge badge-warning">违规</span>':'<span class="badge badge-danger">删除</span>'}},{column:"ip",title:"来源IP",width:"150px"},{column:"ipAddress",title:"IP归属地",width:"250px"},{column:"createTime",title:"留言时间",width:"180px"},{column:"action",title:"操作",class:"cell-action action-2",align:"left",render:function(t,n,e){let i="";return i=i.concat('\n          <button class="info" data-toggle="tooltip" data-placement="top" title="详细信息">\n            <i class="mdi mdi-eye"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          '),i=i.concat('\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n        '),i},events:{"click .info":function(t,n,e,i){a.index=i,a.row=e,s.find("div.content").text(e.originalContent||e.content),s.find("select").bootstrapSelectpicker().set(e.status),s.show()},"click .delete":async function(t,n,o,s){const a=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(a){$(t.currentTarget).setBusy();try{const n=window.lycoris.createRequest();n.url=`${e}/delete`,n.data={ids:[o.id]};const s=await n.post();s&&0==s.resCode&&(window.lycoris.totast.success("删除成功"),i.removeRow("id",o.id))}finally{$(t.currentTarget).clearBusy()}}}}}],i.init(),i.request=t,i.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip()})}const e="/message",i=$("#tb_departments").table(),o={search:$(".table-tool").find("button.btn-success")},s=$("#audit-Modal").bootstrapModal(),a={index:-1,row:{}};o.search.on("click",async function(){$(this).setBusy();try{await i.load()}finally{$(this).clearBusy()}}),s.find("button[save]").on("click",async function(){let t=s.find('select[name="status"]').val();if(0!=t){$(this).setBusy();try{const t=window.lycoris.createRequest();t.url=`${e}/violation`,t.data={id:a.row.id};const n=await t.post();n&&0==n.resCode&&(window.lycoris.totast.success("保存成功"),a.row.status=1,i.updateRow(a.index,a.row))}finally{$(this).clearBusy()}}}),this.init=function(){n(),window.lycoris.loading.hide(),i.load()},this.init()});