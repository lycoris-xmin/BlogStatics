$(function(){function t(t){let e=`\n    <div class="post-header">\n      <span class="badge ${0==t.type?"badge-purple-light":"badge-info-light"}">${0==t.type?"原创":"转载"}</span>\n      <a href="${s}/${t.id}" target="_blank">${t.title}</a>\n    </div>\n    <div class="post-footer flex-start-center">\n      <div class="footer-item">\n        <span class="${0==t.categoryId?"no-category":""} filter">${t.categoryName}</span>\n      </div>\n      <div class="footer-item">\n        <span class="footer-item-label">浏览数</span>\n        <span>${t.browseCount}</span>\n      </div>\n      <div class="footer-item">\n        <span class="footer-item-label">评论数</span>\n        <span>${t.commentCount}</span>\n      </div>\n    </div>\n    `;return e}async function e(t){l.find('select[name="category"]').bootstrapSelectpicker().set(t.toString()),await c.load()}async function n(t,e){t.loading.show();try{const n=t.getValue(),o=window.lycoris.createRequest();o.url=`${s}/comment`,o.data={id:e,comment:n};const i=await o.post();i&&0==i.resCode&&(1==n?window.lycoris.totast.info("启用文章评论成功"):window.lycoris.totast.error("禁用文章评论成功"))}finally{t.loading.hide()}}async function o(t,e){t.loading.show();try{const n=t.getValue(),o=window.lycoris.createRequest();o.url=`${s}/recommend`,o.data={id:e,recommend:n};const i=await o.post();i&&0==i.resCode&&(1==n?window.lycoris.totast.info("设置文章推荐成功"):window.lycoris.totast.warn("取消文章推荐成功"))}finally{t.loading.hide()}}function i(){c.options.toolbar=".table-tool",c.options.showCheckbox=!1,c.options.showColumns=!1,c.options.autoHeight=!0,c.options.resize=!0,c.pageOptions.pageSize=10,c.pageOptions.pageList=[10,20,50],c.columns=[{column:"title",title:"文章",render:function(e,n,o){return t(n)},events:{"click span.filter":async function(t,n,o,i){e(o.categoryId)}}},{column:"comment",title:"文章评论",width:"110",render:function(t,e){return`\n          <select class="form-control selectpicker" data-id="${e.id}">\n            <option value="1" ${t?"selected":""}>允许</option>  \n            <option value="0" ${t?"":"selected"}>禁止</option>\n          </select>\n          `},events:{"change .selectpicker":async function(t,e,o,i){const a=$(t.currentTarget).bootstrapSelectpicker();n(a,o.id)}}},{column:"recommend",title:"文章推荐",width:"120",render:function(t,e){return`\n          <select class="form-control selectpicker" data-id="${e.id}">\n            <option value="1" ${t?"selected":""}>推荐</option>  \n            <option value="0" ${t?"":"selected"}>不推荐</option>\n          </select>\n          `},events:{"change .selectpicker":async function(t,e,n,i){const a=$(t.currentTarget).bootstrapSelectpicker();o(a,n.id)}}},{column:"isPublish",title:"文章状态",width:"80",align:"center",render:function(t){return`<span class="badge badge-${t?"info":"secondary"}" >${t?"已发布":"未发布"}</span>`}},{column:"action",title:"操作",class:"cell-action action-2",align:"center",render:function(){let t='\n          <button class="update" data-toggle="tooltip" data-placement="top" title="编辑">\n            <i class="mdi mdi-pencil"></i>\n          </button>\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          ';return t},events:{"click .update":function(t,e,n,o){window.parent.lycoris.multitabs.create(n.title.length>18?n.title.substr(0,18):n.title,`${window.lycoris.console}/Post/Update/${n.id}`)},"click .delete":async function(t,e,n,o){const i=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(i){$(t.currentTarget).attr("disabled","disabled");try{const e=window.lycoris.createRequest();e.url=`${s}/delete`,e.data={id:n.id};const o=await e.post();o&&0==o.resCode&&(window.lycoris.totast.success("删除成功"),c.removeRow("id",n.id))}finally{$(t.currentTarget).removeAttr("disabled")}}}}}],c.init(),c.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip(),$(".selectpicker").bootstrapSelectpicker(!0)}),c.request=a}async function a(t,e){const n=window.lycoris.createRequest();n.url=`${s}/list`,n.data={pageIndex:t,pageSize:e};const o=$(".filter-panel").toJson();o.title&&(n.data.title=o.title),null!=o.type&&(n.data.type=o.type),null!=o.category&&"0"!=o.category&&(n.data.category=o.category),null!=o.isPublish&&(n.data.isPublish=o.isPublish);const i=await n.get();return i&&0==i.resCode?i.data:{}}const s="/post",l=$("div.filter-panel"),c=$("#tb_departments").table(),r={create:$(".table-tool").find("button.btn-info"),search:$(".table-tool").find("button.btn-success")};let d=void 0;r.create.on("click",function(){window.parent.lycoris.multitabs.create("新增文章",`${window.lycoris.console}/Post/Create`)}),r.search.on("click",async function(){$(this).setBusy();try{await c.load()}finally{$(this).clearBusy()}}),this.init=(async()=>{d=window.screen.width,i(),window.lycoris.loading.hide(),await c.load(),window.parent.lycoris.events.on("post.refresh",()=>{c.load()})}),this.init()});