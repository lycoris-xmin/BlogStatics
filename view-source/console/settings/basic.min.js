$(function(){const t=$("#basic"),n={console:""};t.find('input[name="logo"]').on("change",function(t){const n=t.target.files[0];$(this).next().find("img").attr("src",window.lycoris.tool.createObjectURL(n))}),t.find(".logo-view").on("click",function(){$(this).prev().trigger("click")}),t.find("textarea").on("input",function(){const t=$(this).val();$(this).next().find("span").text(t.length),t.length>=$(this).attr("maxlength")?$(this).next().addClass("danger"):$(this).next().removeClass("danger")}),t.find('input[name="avatar"]').on("change",function(t){const n=t.target.files[0];$(this).next().find("img").attr("src",window.lycoris.tool.createObjectURL(n))}),t.find(".avatar-view").on("click",function(){$(this).prev().trigger("click")}),t.find("button[save]").on("click",async function(){const i=t.find("form").toJson();let o={};const a=t.find('input[name="logo"]')[0].files;a.length&&(o.logo=a[0]);const s=t.find('input[name="avatar"]')[0].files;s.length&&(o.avatar=s[0]),$(this).setBusy();try{const a=window.lycoris.createRequest();a.url="/settings/webbasic",a.formData=i;const s=await a.post(o);s&&0==s.resCode&&(window.lycoris.totast.success("保存成功"),s.data.logo&&t.find(".logo-view").find("img").attr("src",s.data.logo),s.data.defaultAvatar&&t.find(".avatar-view").find("img").attr("src",s.data.defaultAvatar),n.console!=s.data.console&&setTimeout(async()=>{n.console=s.data.console,await window.lycoris.swal.info("检测到后台路径变动，页面将重新加载"),window.lycoris.changeConsole(s.data.console)},500))}finally{$(this).clearBusy()}}),this.init=function(){n.console=t.find('input[name="console"]').val(),window.lycoris.events.on("basic",function(i){n.console=i.console,t.formAutoFill(i,{taginput:t=>{$(t).jqueryTagInput({maxTags:5,inputWidth:"90px",maxLimit:function(){window.lycoris.totast.warn("标签最多只能添加五个")}})}}),t.find(".avatar-view>img").attr("src",i.defaultAvatar)})},this.init()});