$(function(){const t=$("#email"),i=t.find(".selectpicker").bootstrapSelectpicker();t.find("button[test]").on("click",async function(){await window.lycoris.swal.custome({title:"邮件服务测试",text:"请输入要接收测试邮件的邮箱地址",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"确 定",cancelButtonText:"取 消",showLoaderOnConfirm:!0,preConfirm:async i=>{if($.regex.email(i))try{const o=t.find("form").toJson(),s=window.lycoris.createRequest();s.url="/settings/email/test",s.data={...o,testEmail:i};const n=await s.post();return n&&0==n.resCode&&window.lycoris.totast.info("测试邮件已发送"),n}catch(t){}else window.lycoris.swal._this.showValidationMessage("请输入正确的邮箱地址")},allowOutsideClick:()=>!window.lycoris.swal._this.isLoading()})}),t.find("button[save]").on("click",async function(){$(this).setBusy();const i=t.find("form").toJson();try{const t=window.lycoris.createRequest();t.url="/settings/email",t.data={...i};const o=await t.post();o&&0==o.resCode&&window.lycoris.totast.success("保存成功")}finally{$(this).clearBusy()}}),this.init=function(){window.lycoris.events.on("email",function(o){t.formAutoFill(o),o.useSSL&&i.set(o.useSSL.toString())})},this.init()});