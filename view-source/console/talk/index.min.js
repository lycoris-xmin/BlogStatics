$(function(){async function t(t,e){const n=window.lycoris.createRequest();n.url=`${o}/list`,n.data={pageIndex:t,pageSize:e};const i=$(".filter-panel").toJson();for(let t in i){const e=i[t];(e||"number"==typeof e)&&(n.data[t]=i[t])}const a=await n.get();return a&&0==a.resCode?(s.rows=a.data.list,a.data):{}}function e(){i.options.toolbar=".table-tool",i.options.showCheckbox=!1,i.options.showColumns=!1,i.options.autoHeight=!0,i.options.resize=!0,i.options.pageSizeResize=!0,i.columns=[{column:"createTime",title:"发布时间",width:"180px"},{column:"content",title:"内容",render:function(t){return t}},{column:"action",title:"操作",class:"cell-action action-2",align:"center",render:function(t,e,n){let o='\n          <button class="info" data-toggle="tooltip" data-placement="top" title="编辑">\n            <i class="mdi mdi-pencil"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n          ';return o=o.concat('\n          <button class="delete" data-toggle="tooltip" data-placement="top" title="删除">\n            <i class="mdi mdi-delete"></i>\n            <i class="mdi mdi-loading mdi-spin"></i>\n          </button>\n        '),o},events:{"click .info":function(t,e,n,o){s.showIndex=o,s.row=n,l.show()},"click .delete":function(t,e,o,i){n.call(t.currentTarget,o)}}}],i.init(),i.request=t,i.loadCompelte=(()=>{$('[data-toggle="tooltip"]').tooltip()})}async function n(t){const e=await window.lycoris.swal.confirm("数据删除后不可恢复","确定要删除吗");if(e){$(this).setBusy();try{const e=window.lycoris.createRequest();e.url=`${o}/delete`,e.data={id:t.id};const n=await e.post();n&&0==n.resCode&&(window.lycoris.totast.success("删除成功"),i.removeRow("id",t.id))}finally{$(this).clearBusy()}}}const o="/talk",i=$("#tb_departments").table(),a={create:$(".table-tool").find("button.btn-info"),search:$(".table-tool").find("button.btn-success")},s={showIndex:-1,row:[]},l=$("#create-update-Modal").bootstrapModal();a.search.on("click",async function(){$(this).setBusy();try{await i.load()}finally{$(this).clearBusy()}}),a.create.on("click",async function(){l.show()}),l.find("textarea").on("input",function(){const t=$(this).val(),e=$(this).next().find("span.value");e.text(t.length),t.length>=300?e.addClass("text-danger"):e.removeClass("text-danger")}),l.handleShow(()=>{if(-1==s.showIndex)l.find("h6").text("发布瞬间");else if(l.find("h6").text("编辑瞬间"),s.row&&s.row.id){l.find("textarea").val(s.row.content);const t=l.find("textarea").next().find("span.value");t.text(s.row.content.length),s.row.content.length>=300?t.addClass("text-danger"):t.removeClass("text-danger")}}),l.handleHidden(()=>{s.showIndex=-1,s.row={},l.find("textarea").val("")}),l.find("button[save]").on("click",async function(){const t=l.find("textarea").val();if(t)if(t.length>300)window.lycoris.totast.warn("内容字数不能超过300字符");else{$(this).setBusy();try{const e=window.lycoris.createRequest();e.url=`${o}/createorupdate`,e.data={content:t},s.showIndex>-1&&s.row.id&&(e.data.id=s.row.id);const n=await e.post();n&&0==n.resCode&&(window.lycoris.totast.success("保存成功"),-1==s.showIndex?i.createRow(n.data,!1):i.updateRow(s.showIndex,n.data),l.hide())}finally{$(this).clearBusy()}}else l.hide()}),this.init=function(){e(),window.lycoris.loading.hide(),i.load()},this.init()});