$(function(){$.createHttpRequest=function(){function e(){const e=`${n}${r.url.startsWith("/")?r.url.replace("/",""):r.url}`;return e.startsWith("/")?e:`/${e}`}function t(){t=o?async function(e,t,s){e.headers=e.headers||{},r.headers&&Object.keys(r.headers).length>0&&Object.assign(e.headers,{...r.headers}),r.interceptors.request&&"function"==typeof r.interceptors.request&&(e=await r.interceptors.request(e));let o={method:e.type,headers:e.headers};if("GET"==o.method){if(e.data){const t=[];Object.keys(e.data).forEach(s=>t.push(`${s}=${e.data[s]}`)),e.url+=`${-1===e.url.search(/\?/)?"?":"&"}${t.join("&")}`}}else"POST"==o.method&&(e.data&&Object.keys(e.data).length?(o.headers["Content-Type"]||(o.headers["Content-Type"]="application/json"),o.body=JSON.stringify(e.data)):e.formData&&(o.body=e.formData));fetch(e.url,o).then(async o=>{const n=await o.json();if(r.interceptors.response&&"function"==typeof r.interceptors.response){const a={response:{status:o.status,json:()=>n},request:{option:{...e},success:t,error:s}};await r.interceptors.response(a)}t(n)}).catch(async o=>{if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{},error:{...o},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}s(o)})}:async function(e,t,s){if(e.headers=e.headers||{},r.headers&&Object.keys(r.headers).length>0&&Object.assign(e.headers,{...r.headers}),e.timeout=r.timeout,e.dataType="json",r.interceptors.request&&"function"==typeof r.interceptors.request&&(e=await r.interceptors.request(e)),"GET"==e.type){if(e.data){const t=[];Object.keys(e.data).forEach(s=>t.push(`${s}=${e.data[s]}`)),e.url+=`${-1===e.url.search(/\?/)?"?":"&"}${t.join("&")}`}}else"POST"==e.type&&(e.contentType||(e.contentType="application/json"),e.data&&Object.keys(e.data).length?e.data=JSON.stringify(e.data):e.formData&&(e.contentType,e.processData=!1,e.cache=!1,e.data=e.formData));$.ajax({...e,success:async function(o,n,a){if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{...a,json:()=>o},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}t(o)},error:async function(o,n,a){if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{...o},error:{...err},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}s(err)}})}}function s(e,t){let r=new FormData;for(var o in e)if(e.hasOwnProperty(o)){var n=e[o],a=t?`${t}[${o}]`:o;if(Array.isArray(n))for(var i=0;i<n.length;i++)"object"==typeof n[i]?s(n[i],r,`${a}[${i}]`):r.append(`${a}[${i}]`,n[i]);else"object"!=typeof n||n instanceof Blob?r.append(a,n):s(n,r,a)}return r}const r=this,o="function"==typeof window.fetch;let n=`${window.lycoris&&window.lycoris.console||""}/`;return this.url="",this.timeout=6e4,this.headers={},this.data={},this.formData=void 0,this.setBaseUrl=(e=>{n=e||""}),this.get=function(){return new Promise((s,o)=>{let n={url:e(),type:"GET"};r.data&&Object.keys(r.data).length>0&&(n.data={...r.data}),t(n,e=>{s(e)},e=>{o(e)})})},this.post=function(o){return new Promise((n,a)=>{let i={url:e(),type:"POST"};if(r.data&&Object.keys(r.data).length>0?i.data={...r.data}:r.formData&&(i.formData=s(r.formData)),o)if(Array.isArray(o)&&o.length)for(let e=0;e<o.length;e++)i.formData.append(`file[${e}]`,o[e]);else if(Object.keys(o).length)for(let e in o)i.formData.append(e,o[e]);t(i,e=>{n(e)},e=>{a(e)})})},this.interceptors={request:e=>(e.headers["X-Timestamp"]=+new Date,e),response:async e=>{try{if(200==e.response.status){const t=e.response.json();if(!t)return void window.lycoris.totast.error("请求失败");if(-99==t.resCode)return void window.lycoris.totast.warn(t.resMsg||"请求失败");if(-21==t.resCode)return window.lycoris.totast.warn("登录过期，请重新登录"),void setTimeout(()=>{const e=`${window.lycoris.console}/authentication/login`;window.top==window.self?location.href=e:window.parent.location.href=e},1e3)}}catch(e){}}},t(),this}});