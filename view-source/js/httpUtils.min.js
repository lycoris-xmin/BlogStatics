$(function(){$.createHttpRequest=function(){function e(){e=s?async function(e,t,s){e.headers=e.headers||{},r.headers&&Object.keys(r.headers).length>0&&Object.assign(e.headers,{...r.headers}),r.interceptors.request&&"function"==typeof r.interceptors.request&&(e=await r.interceptors.request(e));let o={method:e.type,headers:e.headers};if("GET"==o.method){if(e.data){const t=[];Object.keys(e.data).forEach(r=>t.push(`${r}=${e.data[r]}`)),e.url+=`${-1===e.url.search(/\?/)?"?":"&"}${t.join("&")}`}}else"POST"==o.method&&(e.data&&Object.keys(e.data).length?(o.headers["Content-Type"]||(o.headers["Content-Type"]="application/json"),o.body=JSON.stringify(e.data)):e.formData&&(o.body=e.formData));fetch(e.url,o).then(async o=>{const n=await o.json();if(r.interceptors.response&&"function"==typeof r.interceptors.response){const a={response:{status:o.status,json:()=>n},request:{option:{...e},success:t,error:s}};await r.interceptors.response(a)}t(n)}).catch(async o=>{if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{},error:{...o},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}s(o)})}:async function(e,t,s){if(e.headers=e.headers||{},r.headers&&Object.keys(r.headers).length>0&&Object.assign(e.headers,{...r.headers}),e.timeout=r.timeout,e.dataType="json",r.interceptors.request&&"function"==typeof r.interceptors.request&&(e=await r.interceptors.request(e)),"GET"==e.type){if(e.data){const t=[];Object.keys(e.data).forEach(r=>t.push(`${r}=${e.data[r]}`)),e.url+=`${-1===e.url.search(/\?/)?"?":"&"}${t.join("&")}`}}else"POST"==e.type&&(e.contentType||(e.contentType="application/json"),e.data&&Object.keys(e.data).length?e.data=JSON.stringify(e.data):e.formData&&(e.contentType,e.processData=!1,e.cache=!1,e.data=e.formData));$.ajax({...e,success:async function(o,n,a){if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{...a,json:()=>o},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}t(o)},error:async function(o,n,a){if(r.interceptors.response&&"function"==typeof r.interceptors.response){const n={response:{...o},error:{...err},request:{option:{...e},success:t,error:s}};await r.interceptors.response(n)}s(err)}})}}function t(e,r){let s=new FormData;for(var o in e)if(e.hasOwnProperty(o)){var n=e[o],a=r?`${r}[${o}]`:o;if(Array.isArray(n))for(var i=0;i<n.length;i++)"object"==typeof n[i]?t(n[i],s,`${a}[${i}]`):s.append(`${a}[${i}]`,n[i]);else"object"!=typeof n||n instanceof Blob?s.append(a,n):t(n,s,a)}return s}const r=this,s="function"==typeof window.fetch,o=`${window.lycoris&&window.lycoris.console||""}/`;return this.url="",this.timeout=6e4,this.headers={},this.data={},this.formData=void 0,this.get=function(){return new Promise((t,s)=>{let n={url:`${o}${r.url.startsWith("/")?r.url.replace("/",""):r.url}`,type:"GET"};r.data&&Object.keys(r.data).length>0&&(n.data={...r.data}),e(n,e=>{t(e)},e=>{s(e)})})},this.post=function(s){return new Promise((n,a)=>{let i={url:`${o}${r.url.startsWith("/")?r.url.replace("/",""):r.url}`,type:"POST"};if(r.data&&Object.keys(r.data).length>0?i.data={...r.data}:r.formData&&(i.formData=t(r.formData)),s)if(Array.isArray(s)&&s.length)for(let e=0;e<s.length;e++)i.formData.append(`file[${e}]`,s[e]);else if(Object.keys(s).length)for(let e in s)i.formData.append(e,s[e]);e(i,e=>{n(e)},e=>{a(e)})})},this.interceptors={request:e=>(e.headers["X-Timestamp"]=+new Date,e),response:async e=>{try{if(200==e.response.status){const t=e.response.json();if(!t)return void window.lycoris.totast.error("请求失败");if(-99==t.resCode)return void window.lycoris.totast.warn(t.resMsg||"请求失败");if(-21==t.resCode)return window.lycoris.totast.warn("登录过期，请重新登录"),void setTimeout(()=>{const e=`${window.lycoris.console}/authentication/login`;window.top==window.self?location.href=e:window.parent.location.href=e},1e3)}}catch(e){}}},e(),this}});