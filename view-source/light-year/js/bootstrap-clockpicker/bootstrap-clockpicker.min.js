(function(){function t(t){return document.createElementNS(h,t)}function i(t){return(t<10?"0":"")+t}function e(t){var i=++b+"";return t?t+i:i}function s(s,c){function n(t,i){var e=p.offset(),s=/^touch/.test(t.type),n=e.left+w,a=e.top+w,r=(s?t.originalEvent.touches[0]:t).pageX-n,h=(s?t.originalEvent.touches[0]:t).pageY-a,k=Math.sqrt(r*r+h*h),d=!1;if(!i||!(k<y-A||k>y+A)){t.preventDefault();var f=setTimeout(function(){o.addClass("clockpicker-moving")},200);u&&p.append(H.canvas),H.setHand(r,h,!i,!0),l.off(v).on(v,function(t){t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.touches[0]:t).pageX-n,s=(i?t.originalEvent.touches[0]:t).pageY-a;(d||e!==r||s!==h)&&(d=!0,H.setHand(e,s,!1,!0))}),l.off(m).on(m,function(t){l.off(m),t.preventDefault();var e=/^touch/.test(t.type),s=(e?t.originalEvent.changedTouches[0]:t).pageX-n,u=(e?t.originalEvent.changedTouches[0]:t).pageY-a;(i||d)&&s===r&&u===h&&H.setHand(s,u),"hours"===H.currentView?H.toggleView("minutes",V/2):c.autoclose&&(H.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){H.done()},V/2)),p.prepend(O),clearTimeout(f),o.removeClass("clockpicker-moving"),l.off(v)})}}var a=r(C),p=a.find(".clockpicker-plate"),h=a.find(".clockpicker-hours"),k=a.find(".clockpicker-minutes"),d=a.find(".clockpicker-am-pm-block"),g="INPUT"===s.prop("tagName"),b=g?s:s.find("input"),P=s.find(".input-group-addon"),H=this;if(this.id=e("cp"),this.element=s,this.options=c,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=g,this.input=b,this.addon=P,this.popover=a,this.plate=p,this.hoursView=h,this.minutesView=k,this.amPmBlock=d,this.spanHours=a.find(".clockpicker-span-hours"),this.spanMinutes=a.find(".clockpicker-span-minutes"),this.spanAmPm=a.find(".clockpicker-span-am-pm"),this.amOrPm="PM",c.twelvehour){var x=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");r(x);r('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){H.amOrPm="AM",r(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),r('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){H.amOrPm="PM",r(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}c.autoclose||r('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+c.donetext+"</button>").click(r.proxy(this.done,this)).appendTo(a),"top"!==c.placement&&"bottom"!==c.placement||"top"!==c.align&&"bottom"!==c.align||(c.align="left"),"left"!==c.placement&&"right"!==c.placement||"left"!==c.align&&"right"!==c.align||(c.align="top"),a.addClass(c.placement),a.addClass("clockpicker-align-"+c.align),this.spanHours.click(r.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(r.proxy(this.toggleView,this,"minutes")),b.on("focus.clockpicker click.clockpicker",r.proxy(this.show,this)),P.on("click.clockpicker",r.proxy(this.toggle,this));var E,S,I,D=r('<div class="clockpicker-tick"></div>');if(c.twelvehour)for(E=1;E<13;E+=1){S=D.clone(),I=E/6*Math.PI;var B=y;S.css("font-size","120%"),S.css({left:w+Math.sin(I)*B-A,top:w-Math.cos(I)*B-A}),S.html(0===E?"00":E),h.append(S),S.on(f,n)}else for(E=0;E<24;E+=1){S=D.clone(),I=E/6*Math.PI;var z=E>0&&E<13;B=z?M:y;S.css({left:w+Math.sin(I)*B-A,top:w-Math.cos(I)*B-A}),z&&S.css("font-size","120%"),S.html(0===E?"00":E),h.append(S),S.on(f,n)}for(E=0;E<60;E+=5)S=D.clone(),I=E/30*Math.PI,S.css({left:w+Math.sin(I)*y-A,top:w-Math.cos(I)*y-A}),S.css("font-size","120%"),S.html(i(E)),k.append(S),S.on(f,n);if(p.on(f,function(t){0===r(t.target).closest(".clockpicker-tick").length&&n(t,!0)}),u){var O=a.find(".clockpicker-canvas"),j=t("svg");j.setAttribute("class","clockpicker-svg"),j.setAttribute("width",T),j.setAttribute("height",T);var L=t("g");L.setAttribute("transform","translate("+w+","+w+")");var U=t("circle");U.setAttribute("class","clockpicker-canvas-bearing"),U.setAttribute("cx",0),U.setAttribute("cy",0),U.setAttribute("r",2);var W=t("line");W.setAttribute("x1",0),W.setAttribute("y1",0);var N=t("circle");N.setAttribute("class","clockpicker-canvas-bg"),N.setAttribute("r",A);var X=t("circle");X.setAttribute("class","clockpicker-canvas-fg"),X.setAttribute("r",3.5),L.appendChild(W),L.appendChild(N),L.appendChild(X),L.appendChild(U),j.appendChild(L),O.append(j),this.hand=W,this.bg=N,this.fg=X,this.bearing=U,this.g=L,this.canvas=O}}var o,c,n,a,r=window.jQuery,p=r(window),l=r(document),h="http://www.w3.org/2000/svg",u="SVGAngle"in window&&(n=document.createElement("div"),n.innerHTML="<svg/>",c=(n.firstChild&&n.firstChild.namespaceURI)==h,n.innerHTML="",c),k=(a=document.createElement("div").style,"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a),d="ontouchstart"in window,f="mousedown"+(d?" touchstart":""),v="mousemove.clockpicker"+(d?" touchmove.clockpicker":""),m="mouseup.clockpicker"+(d?" touchend.clockpicker":""),g=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,b=0,w=100,y=80,M=54,A=13,T=2*w,V=k?350:1,C=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");s.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},s.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},s.prototype.locate=function(){var t=this.element,i=this.popover,e=t.offset(),s=t.outerWidth(),o=t.outerHeight(),c=this.options.placement,n=this.options.align,a={};switch(i.show(),c){case"bottom":a.top=e.top+o;break;case"right":a.left=e.left+s;break;case"top":a.top=e.top-i.outerHeight();break;case"left":a.left=e.left-i.outerWidth()}switch(n){case"left":a.left=e.left;break;case"right":a.left=e.left+s-i.outerWidth();break;case"top":a.top=e.top;break;case"bottom":a.top=e.top+o-i.outerHeight()}i.css(a)},s.prototype.show=function(t){if(!this.isShown){var e=this;this.isAppended||(o=r(document.body).append(this.popover),p.on("resize.clockpicker"+this.id,function(){e.isShown&&e.locate()}),this.isAppended=!0);var s=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===s[0]){var c=new Date(+new Date+this.options.fromnow);s=[c.getHours(),c.getMinutes()]}this.hours=+s[0]||0,this.minutes=+s[1]||0,this.spanHours.html(i(this.hours)),this.spanMinutes.html(i(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,l.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var i=r(t.target);0===i.closest(e.popover).length&&0===i.closest(e.addon).length&&0===i.closest(e.input).length&&e.hide()}),l.on("keyup.clockpicker."+this.id,function(t){27===t.keyCode&&e.hide()})}},s.prototype.hide=function(){this.isShown=!1,l.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),l.off("keyup.clockpicker."+this.id),this.popover.hide()},s.prototype.toggleView=function(t,i){var e="hours"===t,s=e?this.hoursView:this.minutesView,o=e?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",e),this.spanMinutes.toggleClass("text-primary",!e),o.addClass("clockpicker-dial-out"),s.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){o.css("visibility","hidden")},V)},s.prototype.resetClock=function(t){var i=this.currentView,e=this[i],s="hours"===i,o=Math.PI/(s?6:30),c=e*o,n=s&&e>0&&e<13?M:y,a=Math.sin(c)*n,r=-Math.cos(c)*n,p=this;u&&t?(p.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){p.canvas.removeClass("clockpicker-canvas-out"),p.setHand(a,r)},t)):this.setHand(a,r)},s.prototype.setHand=function(t,e,s,o){var c,n=Math.atan2(t,-e),a="hours"===this.currentView,p=Math.PI/(a||s?6:30),l=Math.sqrt(t*t+e*e),h=this.options,k=a&&l<(y+M)/2,d=k?M:y;if(h.twelvehour&&(d=y),n<0&&(n=2*Math.PI+n),c=Math.round(n/p),n=c*p,h.twelvehour?a?0===c&&(c=12):(s&&(c*=5),60===c&&(c=0)):a?(12===c&&(c=0),c=k?0===c?12:c:0===c?0:c+12):(s&&(c*=5),60===c&&(c=0)),this[this.currentView]!==c&&g&&this.options.vibrate&&(this.vibrateTimer||(navigator[g](10),this.vibrateTimer=setTimeout(r.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=c,this[a?"spanHours":"spanMinutes"].html(i(c)),u){o||!a&&c%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var f=Math.sin(n)*d,v=-Math.cos(n)*d;this.hand.setAttribute("x2",f),this.hand.setAttribute("y2",v),this.bg.setAttribute("cx",f),this.bg.setAttribute("cy",v),this.fg.setAttribute("cx",f),this.fg.setAttribute("cy",v)}else this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=r(this);t.toggleClass("active",c===+t.html())})},s.prototype.done=function(){this.hide();var t=this.input.prop("value"),e=i(this.hours)+":"+i(this.minutes);this.options.twelvehour&&(e+=this.amOrPm),this.input.prop("value",e),e!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur")},s.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(p.off("resize.clockpicker"+this.id),this.popover.remove())},r.fn.clockpicker=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=r(this),o=e.data("clockpicker");if(o)"function"==typeof o[t]&&o[t].apply(o,i);else{var c=r.extend({},s.DEFAULTS,e.data(),"object"==typeof t&&t);e.data("clockpicker",new s(e,c))}})}})();