if("undefined"==typeof jQuery)throw new Error("MultiTabs requires jQuery");(function(t){"use strict";var a,e,n,i,s,r,l,o,c,d;a=".multitabs",n=function(t,e,n,i,s){var r=s?e:e.split(" ").join(a+" ")+a;t.off(r,n,i).on(r,n,i)},i=function(t,a){if("main"===t)return 0;var e=window.btoa(a);return e=e.replace(/\+/g,"_43"),e=e.replace(/\//g,"_47"),e=e.replace(/=/g,"_61"),e},l=function(a,e){e=e||t.fn.multitabs.defaults.navTab.maxTitleLength;for(var n=(a+"").split(" "),i="",s=0;s<n.length;s++){var r=t.trim(n[s]);i+=r?r+" ":""}return i.length>e&&(i=i.substr(0,e),i+="..."),i},o=function(t){return!(void 0===sessionStorage)&&t},r=function(a){var e=0;return t(a).each(function(){e+=t(this).outerWidth(!0)}),e},s=function(t){var a=function(t){var a=document.createElement("a");return a.href=t,a.href}(t),e=window.location.protocol+"//"+window.location.host+"/",n=a.substr(0,e.length);return!(n===e)},c={default:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><div class="mt-nav mt-nav-tools-left"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-left"><a class="nav-link"><i class="mdi mdi-skip-backward"></i></a></li></ul></div><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"></ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="nav-item mt-move-right"><a class="nav-link"><i class="mdi mdi-skip-forward"></i></a></li><li class="nav-item mt-dropdown dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="dropdown-menu dropdown-menu-right"><li class="mt-show-actived-tab"><a class="dropdown-item">{showActivedTab}</a></li><li class="dropdown-divider"></li><li class="mt-close-all-tabs"><a class="dropdown-item">{closeAllTabs}</a></li><li class="mt-close-other-tabs"><a class="dropdown-item">{closeOtherTabs}</a></li></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',classic:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav><div class="mt-nav mt-nav-tools-right"><ul  class="nav {nav-tabs}"><li class="mt-dropdown dropdown"><a href="#"  class="dropdown-toggle dropdown-item" data-toggle="dropdown">{dropdown}<span class="caret"></span></a><ul role="menu" class="mt-hidden-list dropdown-menu dropdown-menu-right"></ul></li></ul></div></div><div class="tab-content mt-tab-content " > </div></div>',simple:'<div class="mt-wrapper {mainClass}" style="height: 100%;" ><div class="mt-nav-bar {navClass}" style="background-color: {backgroundColor};"><nav class="mt-nav mt-nav-panel"><ul  class="nav {nav-tabs}"> </ul></nav></div><div class="tab-content mt-tab-content " > </div></div>',navTab:'<a data-id="{navTabId}" class="nav-link mt-nav-tab" data-type="{type}" data-index="{index}" data-url="{url}">{title}</a>',closeBtn:' <i class="mt-close-tab mdi mdi-close" style="{style}"></i>',ajaxTabPane:'<div id="{tabPaneId}" class="tab-pane {class}">{content}</div>',iframeTabPane:'<iframe id="{tabPaneId}" class="tab-pane {class}"  width="100%" height="100%" frameborder="0" src="" seamless></iframe>'},d=[{type:"main",title:"main",content:"<h1>Demo page</h1><h2>Welcome to use bootstrap multi-tabs :) </h2>"}],e=function(a,e){var n=this;n.$element=t(a),n._init(e)._listen()._final()},e.prototype={constructor:e,create:function(t,a){var e,n;this.options;return(e=this._getParam(t))?(n=this._exist(e),n&&!e.isNewTab?(this.active(n),this):(e.active=e.active?e.active:a,n=this._createNavTab(e),this._createTabPane(e),this._storage(e.did,e),e.active&&this.active(n),this)):this},_createTabPane:function(t){var a=this,e=a.$element;return e.tabContent.append(a._getTabPaneHtml(t)),e.tabContent.find("#"+t.did)},_getTabPaneHtml:function(t){var a=this,e=a.options;return!t.content&&t.iframe?c.iframeTabPane.replace("{class}",e.content.iframe.class).replace("{tabPaneId}",t.did):c.ajaxTabPane.replace("{class}",e.content.ajax.class).replace("{tabPaneId}",t.did).replace("{content}",t.content)},_createNavTab:function(t){var a=this,e=a.$element,n=a._getNavTabHtml(t),i=e.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]').parent("li");return i.length?(i.html(n),a._getTabPane(i.find("a:first")).remove()):e.navPanelList.append('<li class="nav-item">'+n+"</li>"),e.navPanelList.find('a[data-type="'+t.type+'"][data-index="'+t.index+'"]:first')},_getNavTabHtml:function(t){var a,e,n=this,i=n.options;return e=i.nav.showCloseOnHover?"":"display:inline;",a="main"===t.type?"":c.closeBtn.replace("{style}",e),c.navTab.replace("{index}",t.index).replace("{navTabId}",t.did).replace("{url}",t.url).replace("{title}",t.title).replace("{type}",t.type)+a},_generateId:function(t){return"multitabs_"+t.type+"_"+t.index},active:function(t,a){var e=this,n=e.$element;a=0!=a;var i=e._getNavTab(t),s=e._getTabPane(i),r=n.navPanelList.find("li a.active"),l=r.length?e._getParam(r):{},o=i.length?e._getParam(i):{},c=e._storage();return c[l.did]&&(c[l.did].active=!1),c[o.did]&&(c[o.did].active=!0),e._resetStorage(c),r.removeClass("active"),i.addClass("active"),e._fixTabPosition(i),e._getTabPane(r).removeClass("active"),s.addClass("active"),e._fixTabContentLayout(s),e._fillTabPane(s,o,a),e},_fillTabPane:function(a,e,n){var i=this,s=i.options,r=t(a);r.html()||(r.is("iframe")?(!r.attr("src")||!r.attr("src")&&"no"==s.refresh||"nav"==s.refresh&&n||"all"==s.refresh)&&r.attr("src",e.url):t.ajax({url:e.url,dataType:"html",success:function(t){r.html(s.content.ajax.success(t))},error:function(t){r.html(s.content.ajax.error(t))}}))},moveLeft:function(){var t,a=this,e=a.$element,n=Math.abs(parseInt(e.navPanelList.css("margin-left"))),i=e.navPanel.outerWidth(!0),s=r(e.navPanelList.children("li")),l=0,o=0;if(s<i)return a;for(t=e.navPanelList.children("li:first");o+t.width()<=n;)o+=t.outerWidth(!0),t=t.next();if(o=0,r(t.prevAll())>i){for(;o+t.width()<i&&t.length>0;)o+=t.outerWidth(!0),t=t.prev();l=r(t.prevAll())}return e.navPanelList.animate({marginLeft:0-l+"px"},"fast"),a},moveRight:function(){var t,a,e=this,n=e.$element,i=Math.abs(parseInt(n.navPanelList.css("margin-left"))),s=n.navPanel.outerWidth(!0),l=r(n.navPanelList.children("li")),o=0;if(l<s)return e;for(t=n.navPanelList.children("li:first"),a=0;a+t.width()<=i;)a+=t.outerWidth(!0),t=t.next();for(a=0;a+t.width()<s&&t.length>0;)a+=t.outerWidth(!0),t=t.next();return o=r(t.prevAll()),o>0&&n.navPanelList.animate({marginLeft:0-o+"px"},"fast"),e},close:function(t){var a,e=this,n=e._getNavTab(t),i=n.parent("li");if(a=e._getTabPane(n),i.length&&a.length&&a.hasClass("unsave")&&!e._unsaveConfirm())return e;if(i.find("a").hasClass("active")){var s=i.next("li:first"),r=i.prev("li:last");s.length?(e.active(s),e.activeMenu(s.find("a"))):r.length&&(e.active(r),e.activeMenu(r.find("a")))}return e._delStorage(n.attr("data-id")),i.remove(),a.remove(),e},closeOthers:function(a){var e,n=this,i=n.$element;return e=a?i.navPanelList.find('a:not([data-type="main"])').filter(function(e){if(a!=t(this).data("index"))return this}):i.navPanelList.find('li a:not([data-type="main"],.active)'),e.each(function(){var a=t(this);n._delStorage(a.attr("data-id")),n._getTabPane(a).remove(),a.parent("li").remove()}),a&&(n.active(i.navPanelList.find('a[data-index="'+a+'"]')),n.activeMenu(i.navPanelList.find('a[data-index="'+a+'"]'))),i.navPanelList.css("margin-left","0"),n},showActive:function(){var t=this,a=t.$element,e=a.navPanelList.find("li a.active");return t._fixTabPosition(e),t},closeAll:function(){var a=this,e=a.$element;return e.navPanelList.find('a:not([data-type="main"])').each(function(){var e=t(this);a._delStorage(e.attr("data-id")),a._getTabPane(e).remove(),e.parent("li").remove()}),a.active(e.navPanelList.find('a[data-type="main"]:first').parent("li")),a.activeMenu(e.navPanelList.find('a[data-type="main"]:first')),a},activeMenu:function(a){var e=t("a[href$='"+t(a).data("url")+"']"),n=e.parents(".nav-item"),i=n.siblings().find(".nav-subnav:visible").outerHeight();if(t(".nav-drawer .nav-item").not(n).each(function(){window.innerWidth>1024&&t("body").hasClass("lyear-layout-sidebar-close")&&t(this).find(".nav-subnav").hide(),t(this).find(".nav-subnav:visible").slideUp(500),t(this).removeClass("active open")}),t(".nav-drawer").find("li").removeClass("active"),e.parent("li").addClass("active"),n.addClass("active"),!e.parents(".nav-item").first().is(".nav-item-has-subnav")){var s=48*(e.parents(".nav-item").first().prevAll().length-1);t(".lyear-layout-sidebar-info").animate({scrollTop:s},300)}var r=e.parents("ul.nav-subnav").filter(":hidden"),l=r.length;r.each(function(a){t(this).slideDown(500,function(){if(t(this).parent(".nav-item").addClass("open"),a===l-1){var e=0,s=t(".lyear-layout-sidebar-info"),r=n.last().prevAll().length,o=s.outerHeight(),c=t(".sidebar-main").outerHeight(),d=s.scrollTop(),v=t(this).outerHeight(),u=121;u+c-o>=48*r&&(e=48*r),1==n.length?s.animate({scrollTop:e},300):void 0!==i&&null!=i?(e=d+v-i,s.animate({scrollTop:e},300)):d+o-s[0].scrollHeight==0&&(e=d-v,s.animate({scrollTop:e},300))}})})},_init:function(t){var a=this,e=a.$element;return e.html(c[t.nav.layout].replace("{mainClass}",t.class).replace("{navClass}",t.nav.class).replace(/\{nav-tabs\}/g,t.nav.style).replace(/\{backgroundColor\}/g,t.nav.backgroundColor).replace("{dropdown}",t.language.nav.dropdown).replace("{showActivedTab}",t.language.nav.showActivedTab).replace("{closeAllTabs}",t.language.nav.closeAllTabs).replace("{closeOtherTabs}",t.language.nav.closeOtherTabs)),e.wrapper=e.find(".mt-wrapper:first"),e.nav=e.find(".mt-nav-bar:first"),e.navToolsLeft=e.nav.find(".mt-nav-tools-left:first"),e.navPanel=e.nav.find(".mt-nav-panel:first"),e.navPanelList=e.nav.find(".mt-nav-panel:first ul"),e.navToolsRight=e.nav.find(".mt-nav-tools-right:first"),e.tabContent=e.find(".tab-content:first"),0==t.nav.showTabs&&e.nav.hide(),e.navPanel.css("width","calc(100% - 147px)"),a.options=t,a},_final:function(){var a,e,n,i=this,s=i.$element,r=i.options,l=r.init;if(o(r.cache)&&(a=i._storage(),i._resetStorage({}),t.each(a,function(t,a){i.create(a,!1),a.active&&(n=i._getParam(a),i.activeMenu(i._exist(n)))})),t.isEmptyObject(a)){l=!t.isEmptyObject(l)&&l instanceof Array?l:d;for(var c=0;c<l.length;c++)e=i._getParam(l[c]),e&&i.create(e)}return s.navPanelList.children("li").find("a.active").length||i.active(s.navPanelList.find('[data-type="main"]:first')),i},_listen:function(){var a=this,e=a.$element,i=a.options;n(t(document),"click",i.selector,function(){if(a.create(this,!0),!t(this).parent().parent("ul").hasClass("dropdown-menu"))return!1}),n(e.nav,"click",".mt-nav-tab",function(){a.active(this,!1),a.activeMenu(this)}),i.nav.draggable&&n(e.navPanelList,"mousedown",".mt-nav-tab",function(a){var n=t(this),i=n.closest("li"),s=i.prev(),r=!0,l=!1,o="main"===n.data("type"),c="mt_tmp_id_"+(new Date).getTime(),d='<li id="'+c+'" class="mt-dragging" style="width:'+i.outerWidth()+"px; height:"+i.outerHeight()+'px;"><a style="width: 100%;  height: 100%; "></a></li>',v=a.pageX-i.offset().left+e.nav.offset().left;i.before(d),i.addClass("mt-dragging mt-dragging-tab").css({left:a.pageX-v+"px"}),t(document).on("mousemove",function(a){r&&!o&&(i.css({left:a.pageX-v+"px"}),e.navPanelList.children('li:not(".mt-dragging")').each(function(){var a=t(this).offset().left+t(this).outerWidth()+20;if(a>i.offset().left)return t(this).next().attr("id")!==c&&(l=!0,s=t(this),t("#"+c).remove(),s.after(d)),!1}))}).on("selectstart",function(){if(r)return!1}).on("mouseup",function(){r&&(i.removeClass("mt-dragging mt-dragging-tab").css({left:"auto"}),l&&s.after(i),t("#"+c).remove()),r=!1})}),n(e.nav,"contextmenu",".mt-nav-tab",function(e){e.preventDefault();var n=t('<ul class="dropdown-menu" role="menu" id="contextify-menu"/>'),i=t(this),s=i.closest("li"),r=a._getNavTab(s),l=a._getTabPane(r),o=r.length?a._getParam(r):{},c=[{text:"刷新",onclick:function(){var e=t(l);return e.is("iframe")?e.attr("src",o.url):t.ajax({url:o.url,dataType:"html",success:function(t){e.html(a.options.content.ajax.success(t))},error:function(t){e.html(a.options.content.ajax.error(t))}}),n.hide(),!1}}];o=a._getParam(r);"main"!==o.type&&c.push({text:"关闭",onclick:function(){return a.close(r),n.hide(),!1}}),c.push({text:"关闭其他",onclick:function(){return a.closeOthers(r.data("index")),n.hide(),!1}});var d,v=c.length;for(d=0;d<v;d++){var u=c[d],f=t("<li/>");f.append('<a class="dropdown-item" />');var h=f.find("a");h.on("click",u.onclick),h.css("cursor","pointer"),h.html(u.text),n.append(f)}var m=t("#contextify-menu");m.length>0?m!==n&&m.replaceWith(n):t("body").append(n);var p=t(window).scrollTop()+e.clientY,g=n.width()+e.clientX<t(window).width()?e.clientX:e.clientX-n.width(),b=n.height()+e.clientY<t(window).height()?p:p-n.height();n.css("top",b).css("left",g).css("position","fixed").show(),t(this).parents().on("click",function(){n.hide()}),t("#iframe-content").find("iframe").contents().find("body").on("click",function(){n.hide()})}),n(e.nav,"dblclick",".mt-nav-tab",function(e){if(!0===i.dbclickRefresh){var n=t(this),s=n.closest("li"),r=a._getNavTab(s),l=a._getTabPane(r),o=r.length?a._getParam(r):{},c=t(l);c.is("iframe")?c.attr("src",o.url):t.ajax({url:o.url,dataType:"html",success:function(t){c.html(a.options.content.ajax.success(t))},error:function(t){c.html(a.options.content.ajax.error(t))}})}return!1}),n(e.nav,"click",".mt-close-tab",function(){return a.close(t(this).closest("li")),!1}),n(e.nav,"click",".mt-move-left",function(){return a.moveLeft(),!1}),n(e.nav,"click",".mt-move-right",function(){return a.moveRight(),!1}),n(e.nav,"click",".mt-show-actived-tab",function(){a.showActive()}),n(e.nav,"click",".mt-close-all-tabs",function(){a.closeAll()}),n(e.nav,"click",".mt-close-other-tabs",function(){a.closeOthers()});var s=e.nav.outerHeight();return e.tabContent.css("paddingTop",s),i.nav.fixed&&n(t(window),"scroll",function(){var a=t(this).scrollTop();return a=a<e.wrapper.height()-s?a+"px":"auto",e.nav.css("top",a),!1}),"classic"===i.nav.layout&&n(e.nav,"click",".mt-dropdown:not(.open)",function(){var t=a._getHiddenList(),n=e.navToolsRight.find(".mt-hidden-list:first").empty();if(t){for(;t.prevList.length;)n.append(t.prevList.shift().clone());for(;t.nextList.length;)n.append(t.nextList.shift().clone())}else n.append("<li>empty</li>")}),a},_getParam:function(a){if(t.isEmptyObject(a))return!1;var e=this,n=e.options,r={},o=t(a),c=o.data();return r.content=c.content||a.content||"",r.content.length?r.url="":(r.url=c.url||a.url||o.attr("href")||o.attr("url")||"",r.url=t.trim(decodeURIComponent(r.url.replace("#","")))),!(!r.url.length&&!r.content.length)&&(r.isNewTab=c.hasOwnProperty("isNewTab")||a.hasOwnProperty("isNewTab")||n.isNewTab,r.iframe=c.iframe||a.iframe||s(r.url)||n.iframe,r.type=c.type||a.type||n.type,r.title=c.title||a.title||o.text()||r.url.replace("http://","").replace("https://","")||n.language.nav.title,r.title=l(r.title,n.nav.maxTitleLength),r.active=c.active||a.active||!1,r.index=c.index||a.index||i(r.type,r.url),r.did=c.did||a.did||this._generateId(r),r)},_storage:function(t,a){if(o(this.options.cache)){var e=JSON.parse(sessionStorage.multitabs||"{}");return t?a?(e[t]=a,sessionStorage.multitabs=JSON.stringify(e),e):e[t]:e}return{}},_delStorage:function(t){if(o(this.options.cache)){var a=JSON.parse(sessionStorage.multitabs||"{}");return t?(delete a[t],sessionStorage.multitabs=JSON.stringify(a),a):a}return{}},_resetStorage:function(t){o(this.options.cache)&&"object"==typeof t&&(sessionStorage.multitabs=JSON.stringify(t))},_exist:function(t){if(!t||!t.url)return!1;var a=this,e=a.$element,n=e.navPanelList.find('a[data-url="'+t.url+'"]:first');return!!n.length&&n},_getTabPane:function(a){return t("#"+t(a).attr("data-id"))},_getNavTab:function(a){var e=this,n=e.$element,i=t(a).attr("data-id")||t(a).find("a").attr("data-id");return n.navPanelList.find('a[data-id="'+i+'"]:first')},_fixTabPosition:function(a){var e=this,n=e.$element,i=t(a).parent("li"),s=i.outerWidth(!0),l=i.prev().outerWidth(!0),o=i.prev().prev().outerWidth(!0),c=r(i.prevAll()),d=r(i.nextAll()),v=n.navPanel.outerWidth(!0),u=r(n.navPanelList.children("li")),f=0;if(u<v)f=0;else if(l+s+d<=v)for(f=c;u-f+l<v;)i=i.prev(),f-=i.outerWidth();else c+s>v&&(f=c-l-o);f=f>0?f:0,n.navPanelList.animate({marginLeft:0-f+"px"},"fast")},_getHiddenList:function(){var t,a,e=this,n=e.$element,i=Math.abs(parseInt(n.navPanelList.css("margin-left"))),s=n.navPanel.outerWidth(!0),l=r(n.navPanelList.children("li")),o=[],c=[];if(l<s)return!1;for(t=n.navPanelList.children("li:first"),a=0;a+t.width()<=i;)a+=t.outerWidth(!0),o.push(t),t=t.next();if(l>a)for(t=n.navPanelList.children("li:last"),a=l;a>i+s;)a-=t.outerWidth(!0),c.unshift(t),t=t.prev();return{prevList:o,nextList:c}},_fixTabContentLayout:function(a){var e=t(a);e.is("iframe")?(t("body").addClass("full-height-layout"),e.css("height","99%"),window.setTimeout(function(){e.css("height","100%")},0)):t("body").removeClass("full-height-layout")}},t.fn.multitabs=function(a,n){var i,s=t(this),r=n||"multitabs",l=t(document).data(r),o="object"==typeof a&&a;return l||(i=t.extend(!0,{},t.fn.multitabs.defaults,o,s.data()),i.nav.style="nav-pills"===i.nav.style?"nav-pills":"nav-tabs",l=new e(this,i),t(document).data(r,l)),t(document).data(r)},t.fn.multitabs.defaults={selector:".multitabs",iframe:!1,cache:!1,class:"",type:"info",init:[],isNewTab:!1,refresh:"no",dbclickRefresh:!1,nav:{backgroundColor:"#f5f5f5",class:"",draggable:!0,fixed:!1,layout:"default",showTabs:!0,maxTitleLength:25,showCloseOnHover:!1,style:"nav-tabs"},content:{ajax:{class:"",error:function(t){return t},success:function(t){return t}},iframe:{class:""}},language:{nav:{title:"Tab",dropdown:'<i class="mdi mdi-menu"></i>',showActivedTab:"显示当前选项卡",closeAllTabs:"关闭所有标签页",closeOtherTabs:"关闭其他标签页"}}}})(jQuery);