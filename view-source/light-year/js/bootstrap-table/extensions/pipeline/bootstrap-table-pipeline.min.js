const Utils=$.fn.bootstrapTable.utils,BootstrapTable=($.extend($.fn.bootstrapTable.defaults,{usePipeline:!1,pipelineSize:1e3,onCachedDataHit(t){return!1},onCachedDataReset(t){return!1}}),$.extend($.fn.bootstrapTable.Constructor.EVENTS,{"cached-data-hit.bs.table":"onCachedDataHit","cached-data-reset.bs.table":"onCachedDataReset"}),$.fn.bootstrapTable.Constructor),_init=BootstrapTable.prototype.init,_initServer=BootstrapTable.prototype.initServer,_onSearch=BootstrapTable.prototype.onSearch,_onSort=BootstrapTable.prototype.onSort,_onPageListChange=BootstrapTable.prototype.onPageListChange;BootstrapTable.prototype.init=function(...t){this.initPipeline(),_init.apply(this,Array.prototype.slice.apply(t))},BootstrapTable.prototype.initPipeline=function(){this.cacheRequestJSON={},this.cacheWindows=[],this.currWindow=0,this.resetCache=!0},BootstrapTable.prototype.onSearch=function(t){this.options.usePipeline&&(this.resetCache=!0),_onSearch.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.onSort=function(t){this.options.usePipeline&&(this.resetCache=!0),_onSort.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.onPageListChange=function(t){var e=$(t.currentTarget),e=parseInt(e.text());this.options.pipelineSize=this.calculatePipelineSize(this.options.pipelineSize,e),this.resetCache=!0,_onPageListChange.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.calculatePipelineSize=(t,e)=>0===e?0:Math.ceil(t/e)*e,BootstrapTable.prototype.setCacheWindows=function(){this.cacheWindows=[];var e=this.options.totalRows/this.options.pipelineSize;for(let t=0;t<=e;t++){var i=t*this.options.pipelineSize;this.cacheWindows[t]={lower:i,upper:i+this.options.pipelineSize-1}}},BootstrapTable.prototype.setCurrWindow=function(e){for(let t=this.currWindow=0;t<this.cacheWindows.length;t++)if(this.cacheWindows[t].lower<=e&&e<=this.cacheWindows[t].upper){this.currWindow=t;break}},BootstrapTable.prototype.drawFromCache=function(t,e){var i=$.extend(!0,{},this.cacheRequestJSON),t=t-this.cacheWindows[this.currWindow].lower;return i.rows=i.rows.slice(t,t+e),i},BootstrapTable.prototype.initServer=function(i,e,o){var s={},a=this.header.fields.indexOf(this.options.sortName);let r={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};if(this.header.sortNames[a]&&(r.sortName=this.header.sortNames[a]),this.options.pagination&&"server"===this.options.sidePagination&&(r.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,r.pageNumber=this.options.pageNumber),o||this.options.url||this.options.ajax){let t=!0;if("limit"===this.options.queryParamsType&&(r={searchText:r.searchText,sortName:r.sortName,sortOrder:r.sortOrder},this.options.pagination)&&"server"===this.options.sidePagination&&(r.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,r.offset=(this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize)*(this.options.pageNumber-1),this.options.usePipeline?this.cacheWindows.length?(a=this.cacheWindows[this.currWindow],this.resetCache||r.offset<a.lower||r.offset>a.upper?(t=!0,this.setCurrWindow(r.offset),r.drawOffset=r.offset,r.offset=this.cacheWindows[this.currWindow].lower):t=!1):(t=!0,r.drawOffset=r.offset):0===r.limit&&delete r.limit),this.resetCache&&(t=!0,this.resetCache=!1),this.options.usePipeline&&t&&(r.drawLimit=r.limit,r.limit=this.options.pipelineSize),t){if($.isEmptyObject(this.filterColumnsPartial)||(r.filter=JSON.stringify(this.filterColumnsPartial,null)),s=Utils.calculateObjectValue(this.options,this.options.queryParams,[r],s),$.extend(s,e||{}),!1!==s){i||this.$tableLoading.show();const n=this;a=$.extend({},Utils.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:o||this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(s):s,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success(t){t=Utils.calculateObjectValue(n.options,n.options.responseHandler,[t],t),n.options.usePipeline&&(n.cacheRequestJSON=$.extend(!0,{},t),n.options.totalRows=t[n.options.totalField],n.setCacheWindows(),n.setCurrWindow(r.drawOffset),t=n.drawFromCache(r.drawOffset,r.drawLimit),n.trigger("cached-data-reset",t)),n.load(t),n.trigger("load-success",t),i||n.$tableLoading.hide()},error(t){let e=[];"server"===n.options.sidePagination&&((e={})[n.options.totalField]=0,e[n.options.dataField]=[]),n.load(e),n.trigger("load-error",t.status,t),i||n.$tableLoading.hide()}}),this.options.ajax?Utils.calculateObjectValue(this,this.options.ajax,[a],null):(this._xhr&&4!==this._xhr.readyState&&this._xhr.abort(),this._xhr=$.ajax(a))}}else e=this.drawFromCache(r.offset,r.limit),this.load(e),this.trigger("load-success",e),this.trigger("cached-data-hit",e)}};