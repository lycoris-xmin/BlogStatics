import{createPlugin,refineProps,requestJson,addDays}from"@fullcalendar/core";var __assign=function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},API_BASE="https://www.googleapis.com/calendar/v3/calendars",STANDARD_PROPS={url:String,googleCalendarApiKey:String,googleCalendarId:String,data:null},eventSourceDef={parseMeta:function(e){if("object"==typeof(e="string"==typeof e?{url:e}:e)){e=refineProps(e,STANDARD_PROPS);if(!e.googleCalendarId&&e.url&&(e.googleCalendarId=parseGoogleCalendarId(e.url)),delete e.url,e.googleCalendarId)return e}return null},fetch:function(e,t,r){var n,a,o=e.calendar,l=e.eventSource.meta,i=l.googleCalendarApiKey||o.opt("googleCalendarApiKey");i?(n=buildUrl(l),a=buildRequestParams(e.range,i,l.data,o.dateEnv),requestJson("GET",n,a,function(e,n){e.error?r({message:"Google Calendar API: "+e.error.message,errors:e.error.errors,xhr:n}):t({rawEvents:gcalItemsToRawEventDefs(e.items,a.timeZone),xhr:n})},function(e,n){r({message:e,xhr:n})})):r({message:"Specify a googleCalendarApiKey. See http://fullcalendar.io/docs/google_calendar/"})}};function parseGoogleCalendarId(e){var n;return/^[^\/]+@([^\/\.]+\.)*(google|googlemail|gmail)\.com$/.test(e)?e:(n=(n=/^https:\/\/www.googleapis.com\/calendar\/v3\/calendars\/([^\/]*)/.exec(e))||/^https?:\/\/www.google.com\/calendar\/feeds\/([^\/]*)/.exec(e))?decodeURIComponent(n[1]):void 0}function buildUrl(e){return API_BASE+"/"+encodeURIComponent(e.googleCalendarId)+"/events"}function buildRequestParams(e,n,t,r){var a,e=r.canComputeOffset?(a=r.formatIso(e.start),r.formatIso(e.end)):(a=addDays(e.start,-1).toISOString(),addDays(e.end,1).toISOString()),t=__assign({},t||{},{key:n,timeMin:a,timeMax:e,singleEvents:!0,maxResults:9999});return"local"!==r.timeZone&&(t.timeZone=r.timeZone),t}function gcalItemsToRawEventDefs(e,n){return e.map(function(e){return gcalItemToRawEventDef(e,n)})}function gcalItemToRawEventDef(e,n){var t=e.htmlLink||null;return t&&n&&(t=injectQsComponent(t,"ctz="+n)),{id:e.id,title:e.summary,start:e.start.dateTime||e.start.date,end:e.end.dateTime||e.end.date,url:t,location:e.location,description:e.description}}function injectQsComponent(e,r){return e.replace(/(\?.*?)?(#|$)/,function(e,n,t){return(n?n+"&":"?")+r+t})}var main=createPlugin({eventSourceDefs:[eventSourceDef]});export default main;